<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HomeAssistant 添加自定义的红外遥控器，并支持天猫精灵和小度小度 - 魔都水滴</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; }
        nav a { margin-right: 15px; text-decoration: none; color: #333; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
        <a href="/">首页</a>
        <a href="/post/">归档</a>
        <a href="/tag/">标签</a>
    </nav>
    <article>
        <h1>HomeAssistant 添加自定义的红外遥控器，并支持天猫精灵和小度小度</h1>
        <div class="meta">
            发布时间: 2021-05-12
            
            | 标签: 
            
                
                <a href="/tag/homeassistant"><span class="tag">homeassistant</span></a>
            
                
                <a href="/tag/havcs"><span class="tag">havcs</span></a>
            
                
                <a href="/tag/remote"><span class="tag">remote</span></a>
            
            
        </div>
        <div class="content">
            <h1 id="准备工作">准备工作</h1>
<ul>
<li>已联网的<code>米家万能遥控器</code>，且已添加到<code>HomeAssistant</code></li>
<li><code>米家万能遥控器</code>的<code>IP 地址</code>和<code>token</code></li>
</ul>
<blockquote>
<p><code>IP 地址</code>如何获取？
在手机端打开<code>米家 APP</code>，选择已绑定小米账号的设备
点击进入，然后点右上角的<code>...</code>-&gt;<code>更多设置</code>-&gt;<code>网络信息</code>，即可查看设备的<code>IP 地址</code></p>
</blockquote>
<blockquote>
<p><code>token</code>如何获取？
参考1：<a href="https://github.com/PiotrMachowski/Xiaomi-cloud-tokens-extractor">使用开源工具导出小米Token</a>
参考2：<a href="https://www.home-assistant.io/integrations/xiaomi_miio/#retrieving-the-access-token">Retrieving the Access Token</a></p>
</blockquote>
<h1 id="学习自定义指令">学习自定义指令</h1>
<ol>
<li>打开<code>HomeAssistant</code>-&gt;<code>开发者工具</code>-&gt;<code>服务</code>，在<code>服务</code>里面输入<code>xiaomi_miio.remote_learn_command</code>，然后<code>实体</code>里面找到对应的，比如我的『entity_id』是<code>remote.mo_neng_yao_kong_sh</code></li>
<li>点击按钮<code>调用服务</code>，然后在30秒内，拿遥控器对准米家万能遥控器，按需要学习的按键</li>
<li>如果操作无误，系统会收到一条通知，通知内容就是按键红外指令的<code>base64</code>编码。</li>
</ol>
<h1 id="配置自定义指令">配置自定义指令</h1>
<ol>
<li>打开<code>HomeAssistant</code>-&gt;<code>Supervisor</code>-&gt;<code>File editor</code>-&gt;<code>打开 Web UI</code>-&gt;<code>/config/configuration.yaml</code></li>
<li>在已有的<code>remote</code>段落下面，增加<code>commands</code>。
完整的示例配置如下</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">remote</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">xiaomi_miio</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">host</span>: <span style="color:#ae81ff">192.168.1.86</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">token</span>: <span style="color:#ae81ff">8ec29e26xxxxxxxxxfcxxxxd3c9ef9</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">model</span>: <span style="color:#ae81ff">chuangmi.remote.v2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">万能遥控 SH</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">slot</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeout</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hidden</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">commands</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">bladeless_fan_on_off</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">raw:mMynEwlk0mEwlkxmU1AIKZABlMQDDmwCNANeAQUzAIOaAI2AQk3As8Bp5xMwGrAj8AQwhimc5AasGLwffAaIEfwa/BrUFlg1/Br8GtACPBr8Gvwa/AjwBpBXoCG8GLwofCY8GsgFSEo8UPxyvE68H3wmKCGsNdga4C88GJ4A</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">bladeless_fan_shake_head</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">raw:mMynEwlkznMwlgBETSaAGHMwEaAa8AjwCPA+cDEpmByQCJziZgLIAiYKCAEMBZwNfgs+AR4H3g1+Ch4NfhQ2Cz4BDzUBHw1/Br8UPwa/Bi8Ajwa/Br8ZTwa/Fe8FnwCPEW8NfwUPBryAAA==</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">bladeless_fan_speed</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">raw:mMymswlk0mUwlkxmU4AIKYABlMQDDmwCNANTMwDDmgBFAfQBrAEfgNLOJnNwLKA18BrAaymc5BH8GtQofAIUFkgEcBr8LzwhvBH8AgwofAI8Ol5xMwJyCzgDXwa/BQ8CPgGvBr8GtQUPGv8UOwR/A18a/BQ/GU8ZSwGngAA=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">bladeless_fan_timer</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">raw:mMymswlk0mUwlgBETSYAGHNwEaAamYgNMBHACMgEeARIHyTeazMFHwbPAa8Ej5ZNAQkmgDXg2eDZ4NngNeA1gNngx+A1kxmU4BsMBdACSmc5AIYE0wbPDZ8L7wCCmwBHgNYGzYNkBfeDZ4JHgtIGzoNngjsGzIKPi16AiUAA</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">bladeless_fan_wind_type</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">raw:mMymswlk0mUwlgBETSYgGHNgEaAa8AjwLMAa8AhZxMAR0ANMFDwPmAagAhgR/AIKaAEGAIk4mEsmc5ARoAjJvOQGiAjgCzpmA14DWAEeBH4DSBH2DWwXkAWeDX4MXg1+BH4BFhr+AIQNfAIsAQoE5Aj+BZ4EfgEMM4U3nIDRARwBZIDRAfZAAA==</span>
</span></span></code></pre></div><p>上面的示例配置文件，我加入了5条自定义红外命令。</p>
<h1 id="配置命令脚本将命令实体化">配置命令脚本（将命令实体化）</h1>
<ol>
<li>打开<code>HomeAssistant</code>-&gt;<code>Supervisor</code>-&gt;<code>File editor</code>-&gt;<code>打开 Web UI</code>-&gt;<code>/config/scripts.yaml</code></li>
<li>增加配置文件，示例如下</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">bladeless_fan_on_off</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">开关</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sequence</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">remote.send_command</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">entity_id</span>: <span style="color:#e6db74">&#39;remote.mo_neng_yao_kong_sh&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;bladeless_fan_on_off&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">bladeless_fan_shake_head</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">摇头</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sequence</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">remote.send_command</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">entity_id</span>: <span style="color:#e6db74">&#39;remote.mo_neng_yao_kong_sh&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;bladeless_fan_shake_head&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">bladeless_fan_speed</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">风速</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sequence</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">remote.send_command</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">entity_id</span>: <span style="color:#e6db74">&#39;remote.mo_neng_yao_kong_sh&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;bladeless_fan_speed&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">bladeless_fan_wind_type</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">风类</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sequence</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">remote.send_command</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">entity_id</span>: <span style="color:#e6db74">&#39;remote.mo_neng_yao_kong_sh&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;bladeless_fan_wind_type&#39;</span>
</span></span></code></pre></div><h1 id="havcs-设备添加">HAVCS 设备添加</h1>
<blockquote>
<p>命令实体化以后，设备添加就非常简单了</p>
</blockquote>
<ol>
<li>打开<code>HomeAssistant</code>-&gt;<code>HAVCS 设备</code>-&gt;<code>+</code></li>
<li>按各项内容填写即可，填完完成后点击<code>添加</code></li>
<li>所有的<code>HAVCS</code>设备添加完成后，点击<code>刷新</code>按钮即可</li>
</ol>
<h1 id="参考文章">参考文章</h1>
<ul>
<li><a href="https://www.home-assistant.io/integrations/xiaomi_miio/#xiaomi-ir-remote">Xiaomi IR Remote</a></li>
<li><a href="https://bbs.hassbian.com/thread-7413-1-1.html">[技术探讨]新版HA如何加入小米万能遥控器 </a></li>
<li><a href="https://www.feeus.com/%E4%BD%BF%E7%94%A8home-assistant%E6%8E%A7%E5%88%B6%E7%B1%B3%E5%AE%B6%E4%B8%87%E8%83%BD%E9%81%A5%E6%8E%A7%E5%99%A8%E8%BE%93%E5%87%BA%E9%81%A5%E6%8E%A7%E4%BF%A1%E5%8F%B7/">使用Home Assistant控制小米米家万能遥控器输出遥控信号</a></li>
<li><a href="http://www.feeus.com/%e5%b0%86%e7%b1%b3%e5%ae%b6%e4%b8%87%e8%83%bd%e9%81%a5%e6%8e%a7%e5%99%a8%e6%b7%bb%e5%8a%a0%e5%88%b0home-assistant/">将小米米家万能遥控器添加到Home Assistant</a></li>
</ul>
        </div>
    
    
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: "[\"margrop\"]",
      id: '284903d11480ccc1d0946cd3c1e773d88913706c',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
</body>
</html>
