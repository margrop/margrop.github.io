<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>搭建自己的密码管理服务器 Bitwarden - 魔都水滴</title>
<meta name="description" content="很多人对于把密码放在网上，比如 lastpass 虽然官方说是提供加密了，服务器上看不到用户密码，但是还是不太放心，那么就可以搭建开源的 Bitwarden 搭建一个自己的密码管理服务器。 准备：一个 vps 服务器和一个域名且解析 IP 地址到服务器">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://blog.margrop.net/post/deploy-open-source-password-manager-bitwarden/">

<meta property="og:site_name" content="魔都水滴">
<meta property="og:title" content="搭建自己的密码管理服务器 Bitwarden - 魔都水滴">
<meta property="og:description" content="很多人对于把密码放在网上，比如 lastpass 虽然官方说是提供加密了，服务器上看不到用户密码，但是还是不太放心，那么就可以搭建开源的 Bitwarden 搭建一个自己的密码管理服务器。 准备：一个 vps 服务器和一个域名且解析 IP 地址到服务器">
<meta property="og:url" content="https://blog.margrop.net/post/deploy-open-source-password-manager-bitwarden/">
<meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.margrop.net/images/avatar.png"><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="搭建自己的密码管理服务器 Bitwarden - 魔都水滴">
<meta name="twitter:description" content="很多人对于把密码放在网上，比如 lastpass 虽然官方说是提供加密了，服务器上看不到用户密码，但是还是不太放心，那么就可以搭建开源的 Bitwarden 搭建一个自己的密码管理服务器。 准备：一个 vps 服务器和一个域名且解析 IP 地址到服务器"><meta name="twitter:image" content="https://blog.margrop.net/images/avatar.png"><meta property="article:published_time" content="2021-02-17T20:20:06&#43;08:00">
<meta property="article:modified_time" content="2021-02-17T20:20:06&#43;08:00"><meta property="article:tag" content="bitwarden"><meta property="article:tag" content="1password"><meta property="article:tag" content="docker"><meta property="article:tag" content="deploy"><meta property="article:tag" content="lastpass"><meta property="article:tag" content="openssl"><meta property="article:tag" content="letsencrypt"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"魔都水滴"},"dateModified":"2021-02-17T20:20:06+08:00","datePublished":"2021-02-17T20:20:06+08:00","description":"很多人对于把密码放在网上，比如 lastpass 虽然官方说是提供加密了，服务器上看不到用户密码，但是还是不太放心，那么就可以搭建开源的 Bitwarden 搭建一个自己的密码管理服务器。 准备：一个 vps 服务器和一个域名且解析 IP 地址到服务器","headline":"搭建自己的密码管理服务器 Bitwarden","mainEntityOfPage":"https://blog.margrop.net/post/deploy-open-source-password-manager-bitwarden/","url":"https://blog.margrop.net/post/deploy-open-source-password-manager-bitwarden/"}</script>
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; }
        nav a { margin-right: 15px; text-decoration: none; color: #333; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
        <a href="/">首页</a>
        <a href="/post/">归档</a>
        <a href="/tag/">标签</a>
    </nav>
    <article>
        <h1>搭建自己的密码管理服务器 Bitwarden</h1>
        <div class="meta">
            发布时间: 2021-02-17
            
            | 标签: 
            
                
                <a href="/tag/bitwarden"><span class="tag">bitwarden</span></a>
            
                
                <a href="/tag/1password"><span class="tag">1password</span></a>
            
                
                <a href="/tag/docker"><span class="tag">docker</span></a>
            
                
                <a href="/tag/deploy"><span class="tag">deploy</span></a>
            
                
                <a href="/tag/lastpass"><span class="tag">lastpass</span></a>
            
                
                <a href="/tag/openssl"><span class="tag">openssl</span></a>
            
                
                <a href="/tag/letsencrypt"><span class="tag">letsencrypt</span></a>
            
            
        </div>
        <div class="content">
            <p>很多人对于把密码放在网上，比如 lastpass 虽然官方说是提供加密了，服务器上看不到用户密码，但是还是不太放心，那么就可以搭建开源的 Bitwarden 搭建一个自己的密码管理服务器。</p>
<blockquote>
<p>准备：一个 vps 服务器和一个域名且解析 IP 地址到服务器</p>
</blockquote>
<h1 id="安装-docker">安装 Docker</h1>
<h2 id="1-执行官方的安装脚本">1. 执行官方的安装脚本</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget -qO- get.docker.com | bash
</span></span></code></pre></div><h2 id="2-检查安装结果">2. 检查安装结果</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker version
</span></span></code></pre></div><h2 id="3-启动-docker">3. 启动 Docker.</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl start docker
</span></span></code></pre></div><h2 id="4-查看-docker-启动状态绿色-active">4. 查看 Docker 启动状态(绿色 active)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl status docker
</span></span></code></pre></div><h2 id="5-允许-docker-自启动">5. 允许 Docker 自启动</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl enable docker
</span></span></code></pre></div><h1 id="安装-bitwarden">安装 Bitwarden</h1>
<ul>
<li>快速开始</li>
<li>不进行自定义，不需要域名，快速搭建一个 Bitwarden 后端</li>
</ul>
<h2 id="1-拉取-bitwarden_rs-镜像">1. 拉取 bitwarden_rs 镜像</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker pull bitwardenrs/server:latest
</span></span></code></pre></div><h2 id="2-运行容器">2. 运行容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd ~
</span></span><span style="display:flex;"><span>mkdir bw-data
</span></span><span style="display:flex;"><span>docker stop bitwarden
</span></span><span style="display:flex;"><span>docker rm bitwarden
</span></span><span style="display:flex;"><span>docker run -d --name bitwarden -v /root/bw-data/:/data/ -p 80:80 -p 443:443 bitwardenrs/server:latest
</span></span></code></pre></div><h2 id="3-打开防火墙的80端口">3. 打开防火墙的80端口</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>firewall-cmd --permanent --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>80/tcp
</span></span><span style="display:flex;"><span>firewall-cmd --permanent --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>443/tcp
</span></span><span style="display:flex;"><span>firewall-cmd --reload
</span></span></code></pre></div><h1 id="自定义参数运行">自定义参数运行</h1>
<blockquote>
<p>自定义一些参数，加入 HTTPS 支持等。</p>
</blockquote>
<h2 id="1-拉取-bitwarden_rs-镜像-1">1. 拉取 bitwarden_rs 镜像</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker pull bitwardenrs/server:latest
</span></span></code></pre></div><h2 id="2-生成一个-admin-用户管理页面的-token">2. 生成一个 admin 用户管理页面的 token</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl rand -base64 <span style="color:#ae81ff">48</span>
</span></span></code></pre></div><h2 id="3-生成-ssl-证书以启用-https推荐使用-acmesh-免费申请及自动续签">3. 生成 ssl 证书，以启用 https，推荐使用 acme.sh 免费申请及自动续签</h2>
<h3 id="-31-下载并执行-acmesh-脚本">&gt; 3.1 下载并执行 acme.sh 脚本</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl https://get.acme.sh | sh
</span></span></code></pre></div><h3 id="-32-生成证书这只是一种方式其他方式可以自行搜索">&gt; 3.2 生成证书，这只是一种方式，其他方式可以自行搜索</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt install socat <span style="color:#75715e"># debian 系为例</span>
</span></span><span style="display:flex;"><span>acme.sh –issue -d yourdomain.com –standalone
</span></span></code></pre></div><h3 id="-33-将生成的证书拷贝安装到指定文件夹">&gt; 3.3 将生成的证书拷贝安装到指定文件夹</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>acme.sh –installcert -d yourdomain.com <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>–key-file /path/to/yourdomain.com.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>–fullchain-file /path/to/fullchain.cer <span style="color:#ae81ff">\
</span></span></span></code></pre></div><h2 id="4-运行-bitwarden_rs-容器">4. 运行 bitwarden_rs 容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker stop bitwarden
</span></span><span style="display:flex;"><span>docker rm bitwarden
</span></span><span style="display:flex;"><span>docker run -d --name bitwarden <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e SIGNUPS_ALLOWED<span style="color:#f92672">=</span>false <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e INVITATIONS_ALLOWED<span style="color:#f92672">=</span>false <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e ADMIN_TOKEN<span style="color:#f92672">={</span>ADMIN_TOKEN<span style="color:#f92672">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e ROCKET_TLS<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{certs=&#34;/ssl/fullchain.pem&#34;,key=&#34;/ssl/privkey.pem&#34;}&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e DOMAIN<span style="color:#f92672">=</span>https://margrop.net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e DATA_FOLDER<span style="color:#f92672">=</span>/data/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 443:80 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v /root/bw-ssl:/ssl/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v /root/bw-data:/data/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>bitwardenrs/server:latest
</span></span><span style="display:flex;"><span>docker logs --tail<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span> bitwarden
</span></span></code></pre></div><ul>
<li>参数解释：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>SIGNUP_ALLOWED：是否允许注册
</span></span><span style="display:flex;"><span>INVITATIONS_ALLOWED: 是否允许组织邀请注册
</span></span><span style="display:flex;"><span>ADMIN_TOKEN：用户管理界面 <span style="color:#f92672">(</span>/admin<span style="color:#f92672">)</span>，可用于删除用户及邀请用户注册
</span></span><span style="display:flex;"><span>ROCKET_TLS：ssl 证书信息，同时需要配置-v /path/to/host/ssl/:/path/to/docker/ssl/卷，前者为宿主机ssl证书的位置，后者为容器证书位置
</span></span><span style="display:flex;"><span>DOMAIN：域名
</span></span><span style="display:flex;"><span>LOG_FILE、LOG_LEVEL、EXTENDED_LOGGING：日志保存文件路径以及日志等级定义
</span></span><span style="display:flex;"><span>DATA_FOLDER：docker容器数据保存文件夹（默认为 /data），除了定义这个文件夹之外，还可以定义附件、图标缓存、数据库等参数
</span></span><span style="display:flex;"><span>DATABASE_URL：数据库路径
</span></span><span style="display:flex;"><span>ATTACHMENT_FOLDER：附件路径
</span></span><span style="display:flex;"><span>ICON_CACHE_FOLDER：图标缓存路径
</span></span></code></pre></div><p>以上是我自己觉得需要的一些配置，更多参数可参考官方 Wiki。</p>
<ul>
<li>示例：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d –name bitwarden -e SIGNUPS_ALLOWED<span style="color:#f92672">=</span>false -e INVITATIONS_ALLOWED<span style="color:#f92672">=</span>false -e ADMIN_TOKEN<span style="color:#f92672">=</span>bTVsf7Hj99HPxECRPOL9U70bP0Iy5lXmbbJVP2tvwDszB8CClv+MD3TT6mSJTa4L -e ROCKET_TLS<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">{</span>certs<span style="color:#f92672">=</span>”/ssl/bw.withdewhua.space/fullchain.cer”,key<span style="color:#f92672">=</span>”/ssl/bw.withdewhua.space/bw.withdewhua.space.key”<span style="color:#f92672">}</span>’ -e DOMAIN<span style="color:#f92672">=</span>https://bw.withdewhua.space -e LOG_FILE<span style="color:#f92672">=</span>/data/bitwarden.warn.log -e LOG_LEVEL<span style="color:#f92672">=</span>warn -e EXTENDED_LOGGING<span style="color:#f92672">=</span>true -p 443:80 -v /bw-data/:/data/ -v /usr/local/nginx/conf/ssl/:/ssl/ bitwardenrs/server:latest
</span></span></code></pre></div><h1 id="容器操作命令">容器操作命令</h1>
<blockquote>
<p>$name 为 docker run 中定义的 name</p>
</blockquote>
<h2 id="启动容器">启动容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker start $name
</span></span></code></pre></div><h2 id="停止容器">停止容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker stop $name
</span></span></code></pre></div><h2 id="删除容器">删除容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker rm $name
</span></span></code></pre></div><h2 id="查看运行容器">查看运行容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker ps -as
</span></span></code></pre></div><h1 id="升级-bitwarden-镜像">升级 Bitwarden 镜像</h1>
<h2 id="1-重新拉取镜像">1. 重新拉取镜像</h2>
<pre tabindex="0"><code>docker pull bitwardenrs/server:latest
</code></pre><h2 id="2-停止删除原容器">2. 停止、删除原容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker stop bitwarden
</span></span><span style="display:flex;"><span>docker rm bitwarden
</span></span></code></pre></div><h1 id="3-重新运行-docker-run-命令">3. 重新运行 docker run 命令</h1>
<h1 id="4-查看镜像文件">4. 查看镜像文件</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker image ls
</span></span></code></pre></div><h1 id="5-删除原镜像文件-id-在-step4-中可以看到">5. 删除原镜像文件, $ID 在 step4 中可以看到</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker image rm $ID
</span></span></code></pre></div><h1 id="客户端使用方法">客户端使用方法</h1>
<ul>
<li>使用方法就讲下Chrome插件的吧，其他的用法都是类似的。</li>
</ul>
<p>打开插件，点击右上角设置按钮<code>bitwarden-chrome-extension</code>
填入 bitwarden 的域名<code>server-url</code>
保存后正常登录即可。</p>
<p>可以直接从 Bitwarden 官方导出然后导入到自己服务端，</p>
<blockquote>
<p>这个 docker 镜像对于服务器的配置要求不高，内存在 512 就可以了。能用到的功能都有，包括最基本的密码保存、上传附件等，官方需要付费的 TOTP 、密码检测功能也都能直接使用的。 密码放在别人服务器上不放心的
可以自己搭建一个，或者搭建在自家的 nas 上也可以</p>
</blockquote>
<p>参考文章
<a href="https://www.jianshu.com/p/e432752a659d">https://www.jianshu.com/p/e432752a659d</a>
<a href="https://hub.docker.com/r/bitwardenrs/server">https://hub.docker.com/r/bitwardenrs/server</a>
<a href="https://github.com/dani-garcia/bitwarden_rs/wiki">https://github.com/dani-garcia/bitwarden_rs/wiki</a>
<a href="https://host.bitwarden.in/deploying-and-using-of-bitwarden_rs/configuration">https://host.bitwarden.in/deploying-and-using-of-bitwarden_rs/configuration</a></p>
        </div>
    </article>
    
    
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: "[\"margrop\"]",
      id: '20dbd6078caafb3a8ba273c4493c276a2084f59b',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script>LA.init({id: "1vVTUWl7zoRjnKXi",ck: "1vVTUWl7zoRjnKXi"})</script>
    <script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script>
    <script>
      new LingQue.Monitor().init({id:"202teQt8THXwqyve"});
    </script>
</body>
</html>
