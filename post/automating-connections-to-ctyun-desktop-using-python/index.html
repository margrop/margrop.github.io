<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>天翼云电脑永不休眠方法高科技版本（基于Python） - 魔都水滴</title>
<meta name="description" content="原理：定期连接天翼云桌面（需小于1小时间隔） 步骤一：获取请求数据 打开Chrome浏览器的开发者工具： 在Chrome浏览器中按F12或右键选择检查打开开发者工具。 访问并登录天翼云桌面： 访问https://pc.ctyun.cn，并使用你的账号登录云电脑。 复制connect请求的curl命令： 在开发者工具中， …">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://blog.margrop.net/post/automating-connections-to-ctyun-desktop-using-python/">

<meta property="og:site_name" content="魔都水滴">
<meta property="og:title" content="天翼云电脑永不休眠方法高科技版本（基于Python） - 魔都水滴">
<meta property="og:description" content="原理：定期连接天翼云桌面（需小于1小时间隔） 步骤一：获取请求数据 打开Chrome浏览器的开发者工具： 在Chrome浏览器中按F12或右键选择检查打开开发者工具。 访问并登录天翼云桌面： 访问https://pc.ctyun.cn，并使用你的账号登录云电脑。 复制connect请求的curl命令： 在开发者工具中， …">
<meta property="og:url" content="https://blog.margrop.net/post/automating-connections-to-ctyun-desktop-using-python/">
<meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.margrop.net/images/avatar.png"><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="天翼云电脑永不休眠方法高科技版本（基于Python） - 魔都水滴">
<meta name="twitter:description" content="原理：定期连接天翼云桌面（需小于1小时间隔） 步骤一：获取请求数据 打开Chrome浏览器的开发者工具： 在Chrome浏览器中按F12或右键选择检查打开开发者工具。 访问并登录天翼云桌面： 访问https://pc.ctyun.cn，并使用你的账号登录云电脑。 复制connect请求的curl命令： 在开发者工具中， …"><meta name="twitter:image" content="https://blog.margrop.net/images/avatar.png"><meta property="article:published_time" content="2024-06-18T17:41:35&#43;08:00">
<meta property="article:modified_time" content="2024-06-18T17:41:35&#43;08:00"><meta property="article:tag" content="ctyun"><meta property="article:tag" content="python"><meta property="article:tag" content="chrome"><meta property="article:tag" content="天翼云"><meta property="article:tag" content="云电脑"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"魔都水滴"},"dateModified":"2024-06-18T17:41:35+08:00","datePublished":"2024-06-18T17:41:35+08:00","description":"原理：定期连接天翼云桌面（需小于1小时间隔） 步骤一：获取请求数据 打开Chrome浏览器的开发者工具： 在Chrome浏览器中按F12或右键选择检查打开开发者工具。 访问并登录天翼云桌面： 访问https://pc.ctyun.cn，并使用你的账号登录云电脑。 复制connect请求的curl命令： 在开发者工具中， …","headline":"天翼云电脑永不休眠方法高科技版本（基于Python）","mainEntityOfPage":"https://blog.margrop.net/post/automating-connections-to-ctyun-desktop-using-python/","url":"https://blog.margrop.net/post/automating-connections-to-ctyun-desktop-using-python/"}</script>
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; }
        nav a { margin-right: 15px; text-decoration: none; color: #333; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
        <a href="/">首页</a>
        <a href="/post/">归档</a>
        <a href="/tag/">标签</a>
    </nav>
    <article>
        <h1>天翼云电脑永不休眠方法高科技版本（基于Python）</h1>
        <div class="meta">
            发布时间: 2024-06-18
            
            | 标签: 
            
                
                <a href="/tag/ctyun"><span class="tag">ctyun</span></a>
            
                
                <a href="/tag/python"><span class="tag">python</span></a>
            
                
                <a href="/tag/chrome"><span class="tag">chrome</span></a>
            
                
                <a href="/tag/%E5%A4%A9%E7%BF%BC%E4%BA%91"><span class="tag">天翼云</span></a>
            
                
                <a href="/tag/%E4%BA%91%E7%94%B5%E8%84%91"><span class="tag">云电脑</span></a>
            
            
        </div>
        <div class="content">
            <h4 id="原理定期连接天翼云桌面需小于1小时间隔">原理：定期连接天翼云桌面（需小于1小时间隔）</h4>
<h5 id="步骤一获取请求数据">步骤一：获取请求数据</h5>
<ol>
<li>
<p><strong>打开Chrome浏览器的开发者工具</strong>：</p>
<ul>
<li>在Chrome浏览器中按<code>F12</code>或右键选择<code>检查</code>打开开发者工具。</li>
</ul>
</li>
<li>
<p><strong>访问并登录天翼云桌面</strong>：</p>
<ul>
<li>访问<code>https://pc.ctyun.cn</code>，并使用你的账号登录云电脑。</li>
</ul>
</li>
<li>
<p><strong>复制connect请求的curl命令</strong>：</p>
<ul>
<li>在开发者工具中，选择<code>Network</code>标签，找到并点击名为<code>connect</code>的请求。</li>
<li>右键点击该请求，选择<code>Copy as cURL (cmd)</code>。</li>
</ul>
</li>
<li>
<p><strong>获取localStorage中的authData</strong>：</p>
<ul>
<li>在开发者工具中，选择<code>Application</code>标签。</li>
<li>在左侧栏中找到<code>Local Storage</code>并选择<code>https://pc.ctyun.cn</code>。</li>
<li>找到<code>authData</code>键，复制其对应的值。</li>
</ul>
</li>
</ol>
<h5 id="步骤二填充到python脚本">步骤二：填充到Python脚本</h5>
<p>将获取到的curl命令中的相关数据和localStorage中的<code>authData</code>值，复制到临时的记事本中，找到下面Python脚本所需字段，并</p>
<!-- raw HTML omitted -->
<p>填充到以下Python脚本中：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 配置参数（用户需要根据实际情况修改）</span>
</span></span><span style="display:flex;"><span>device_info <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;objId&#34;</span>: <span style="color:#e6db74">&#34;你的设备ID&#34;</span>,  <span style="color:#75715e"># 设备ID</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;objType&#34;</span>: <span style="color:#ae81ff">0</span>,  <span style="color:#75715e"># 设备类型</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;osType&#34;</span>: <span style="color:#ae81ff">15</span>,  <span style="color:#75715e"># 操作系统类型</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;deviceId&#34;</span>: <span style="color:#ae81ff">60</span>,  <span style="color:#75715e"># 设备ID</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;deviceCode&#34;</span>: <span style="color:#e6db74">&#34;你的设备代码&#34;</span>,  <span style="color:#75715e"># 设备代码</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;deviceName&#34;</span>: <span style="color:#e6db74">&#34;你的设备名称&#34;</span>,  <span style="color:#75715e"># 设备名称</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;sysVersion&#34;</span>: <span style="color:#e6db74">&#34;你的系统版本&#34;</span>,  <span style="color:#75715e"># 系统版本</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;appVersion&#34;</span>: <span style="color:#e6db74">&#34;1.36.1&#34;</span>,  <span style="color:#75715e"># 应用版本</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;hostName&#34;</span>: <span style="color:#e6db74">&#34;你的主机名称&#34;</span>,  <span style="color:#75715e"># 主机名称</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;vdCommand&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,  <span style="color:#75715e"># 虚拟桌面命令</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ipAddress&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,  <span style="color:#75715e"># IP地址</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;macAddress&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,  <span style="color:#75715e"># MAC地址</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;hardwareFeatureCode&#34;</span>: <span style="color:#e6db74">&#34;你的硬件特征码&#34;</span>  <span style="color:#75715e"># 硬件特征码</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 请求头中的一些参数</span>
</span></span><span style="display:flex;"><span>app_model_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>device_code_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;你的设备代码&#34;</span>
</span></span><span style="display:flex;"><span>device_type_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;60&#34;</span>
</span></span><span style="display:flex;"><span>request_id_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;你的请求ID值&#34;</span>
</span></span><span style="display:flex;"><span>tenant_id_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;你的租户ID值&#34;</span>
</span></span><span style="display:flex;"><span>userid_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;你的用户ID值&#34;</span>
</span></span><span style="display:flex;"><span>version_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;201360101&#34;</span>
</span></span><span style="display:flex;"><span>secret_key_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;你的秘钥值&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 动态生成时间戳</span>
</span></span><span style="display:flex;"><span>timestamp_value <span style="color:#f92672">=</span> str(int(time<span style="color:#f92672">.</span>time() <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建签名字符串</span>
</span></span><span style="display:flex;"><span>signature_str <span style="color:#f92672">=</span> device_type_value <span style="color:#f92672">+</span> request_id_value <span style="color:#f92672">+</span> tenant_id_value <span style="color:#f92672">+</span> timestamp_value <span style="color:#f92672">+</span> userid_value <span style="color:#f92672">+</span> version_value <span style="color:#f92672">+</span> secret_key_value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用MD5算法创建签名</span>
</span></span><span style="display:flex;"><span>hash_obj <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5()
</span></span><span style="display:flex;"><span>hash_obj<span style="color:#f92672">.</span>update(signature_str<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>))
</span></span><span style="display:flex;"><span>digest_hex <span style="color:#f92672">=</span> hash_obj<span style="color:#f92672">.</span>hexdigest()<span style="color:#f92672">.</span>upper()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 准备请求头</span>
</span></span><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;accept&#39;</span>: <span style="color:#e6db74">&#39;application/json, text/plain, */*&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;accept-language&#39;</span>: <span style="color:#e6db74">&#39;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;content-type&#39;</span>: <span style="color:#e6db74">&#39;application/x-www-form-urlencoded&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-appmodel&#39;</span>: app_model_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-devicecode&#39;</span>: device_code_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-devicetype&#39;</span>: device_type_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-requestid&#39;</span>: request_id_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-signaturestr&#39;</span>: digest_hex,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-tenantid&#39;</span>: tenant_id_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-timestamp&#39;</span>: timestamp_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-userid&#39;</span>: userid_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ctg-version&#39;</span>: version_value,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;origin&#39;</span>: <span style="color:#e6db74">&#39;https://pc.ctyun.cn&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;priority&#39;</span>: <span style="color:#e6db74">&#39;u=1, i&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;referer&#39;</span>: <span style="color:#e6db74">&#39;https://pc.ctyun.cn/&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;sec-ch-ua&#39;</span>: <span style="color:#e6db74">&#39;&#34;Google Chrome&#34;;v=&#34;125&#34;, &#34;Chromium&#34;;v=&#34;125&#34;, &#34;Not.A/Brand&#34;;v=&#34;24&#34;&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;sec-ch-ua-mobile&#39;</span>: <span style="color:#e6db74">&#39;?0&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;sec-ch-ua-platform&#39;</span>: <span style="color:#e6db74">&#39;&#34;Windows&#34;&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;sec-fetch-dest&#39;</span>: <span style="color:#e6db74">&#39;empty&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;sec-fetch-mode&#39;</span>: <span style="color:#e6db74">&#39;cors&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;sec-fetch-site&#39;</span>: <span style="color:#e6db74">&#39;same-site&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;user-agent&#39;</span>: <span style="color:#e6db74">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置API的URL和路径</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://desk.ctyun.cn:8810/api/&#34;</span>
</span></span><span style="display:flex;"><span>computer_connect <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;desktop/client/connect&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 发起POST请求连接云电脑</span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url <span style="color:#f92672">+</span> computer_connect, data<span style="color:#f92672">=</span>device_info, headers<span style="color:#f92672">=</span>headers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打印出云电脑的连接状态</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;云电脑连接状态：&#34;</span>, response<span style="color:#f92672">.</span>json())
</span></span></code></pre></div><h5 id="步骤三定时执行脚本">步骤三：定时执行脚本</h5>
<p>你可以使用以下方法定期执行脚本：</p>
<ol>
<li>
<p><strong>Windows任务计划</strong>：</p>
<ul>
<li>打开<code>任务计划程序</code>，创建一个新的任务。</li>
<li>在<code>操作</code>选项卡中，选择<code>启动程序</code>，然后选择你的Python解释器和脚本路径。</li>
</ul>
</li>
<li>
<p><strong>Linux Crontab</strong>：</p>
<ul>
<li>打开终端，输入<code>crontab -e</code>。</li>
<li>添加一行来定期运行脚本，例如每小时运行一次：
<pre tabindex="0"><code>0 * * * * /usr/bin/python3
</code></pre></li>
</ul>
</li>
</ol>
        </div>
    </article>
    
    
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: "[\"margrop\"]",
      id: '5459ab8e8e69b3f7ec46529072ccc4912c63c07d',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
</body>
</html>
