<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PVE 宿主机磁盘空间监控——从踩坑到接入 Uptime Kuma 的完整小白教程 - 魔都水滴</title>
<meta name="description" content="目标读者 这篇文章写给刚刚接触 Proxmox VE（简称 PVE）且希望“按步骤照做就能跑”的同学。整篇内容力求： 解释 为什么 会遇到问题 每一步都给出 完整命令 出错时给出 排查思路">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://blog.margrop.net/post/pve-host-virtual-machine-lvm-disk-space-monitor-experience/">

<meta property="og:site_name" content="魔都水滴">
<meta property="og:title" content="PVE 宿主机磁盘空间监控——从踩坑到接入 Uptime Kuma 的完整小白教程 - 魔都水滴">
<meta property="og:description" content="目标读者 这篇文章写给刚刚接触 Proxmox VE（简称 PVE）且希望“按步骤照做就能跑”的同学。整篇内容力求： 解释 为什么 会遇到问题 每一步都给出 完整命令 出错时给出 排查思路">
<meta property="og:url" content="https://blog.margrop.net/post/pve-host-virtual-machine-lvm-disk-space-monitor-experience/">
<meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.margrop.net/images/avatar.png"><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PVE 宿主机磁盘空间监控——从踩坑到接入 Uptime Kuma 的完整小白教程 - 魔都水滴">
<meta name="twitter:description" content="目标读者 这篇文章写给刚刚接触 Proxmox VE（简称 PVE）且希望“按步骤照做就能跑”的同学。整篇内容力求： 解释 为什么 会遇到问题 每一步都给出 完整命令 出错时给出 排查思路"><meta name="twitter:image" content="https://blog.margrop.net/images/avatar.png"><meta property="article:published_time" content="2025-05-14T22:11:33&#43;08:00">
<meta property="article:modified_time" content="2025-05-14T22:11:33&#43;08:00"><meta property="article:tag" content="Proxmox VE"><meta property="article:tag" content="lvm"><meta property="article:tag" content="UptimeKuma"><meta property="article:tag" content="Shell"><meta property="article:tag" content="bash"><meta property="article:tag" content="crontab"><meta property="article:tag" content="运维监控"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"魔都水滴"},"dateModified":"2025-05-14T22:11:33+08:00","datePublished":"2025-05-14T22:11:33+08:00","description":"目标读者 这篇文章写给刚刚接触 Proxmox VE（简称 PVE）且希望“按步骤照做就能跑”的同学。整篇内容力求： 解释 为什么 会遇到问题 每一步都给出 完整命令 出错时给出 排查思路","headline":"PVE 宿主机磁盘空间监控——从踩坑到接入 Uptime Kuma 的完整小白教程","mainEntityOfPage":"https://blog.margrop.net/post/pve-host-virtual-machine-lvm-disk-space-monitor-experience/","url":"https://blog.margrop.net/post/pve-host-virtual-machine-lvm-disk-space-monitor-experience/"}</script>
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; }
        nav a { margin-right: 15px; text-decoration: none; color: #333; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
        <a href="/">首页</a>
        <a href="/post/">归档</a>
        <a href="/tag/">标签</a>
    </nav>
    <article>
        <h1>PVE 宿主机磁盘空间监控——从踩坑到接入 Uptime Kuma 的完整小白教程</h1>
        <div class="meta">
            发布时间: 2025-05-14
            
            | 标签: 
            
                
                <a href="/tag/proxmox-ve"><span class="tag">Proxmox VE</span></a>
            
                
                <a href="/tag/lvm"><span class="tag">lvm</span></a>
            
                
                <a href="/tag/uptimekuma"><span class="tag">UptimeKuma</span></a>
            
                
                <a href="/tag/shell"><span class="tag">Shell</span></a>
            
                
                <a href="/tag/bash"><span class="tag">bash</span></a>
            
                
                <a href="/tag/crontab"><span class="tag">crontab</span></a>
            
                
                <a href="/tag/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7"><span class="tag">运维监控</span></a>
            
            
        </div>
        <div class="content">
            <blockquote>
<p><strong>目标读者</strong>
这篇文章写给刚刚接触 Proxmox VE（简称 <strong>PVE</strong>）且希望“按步骤照做就能跑”的同学。整篇内容力求：</p>
<ul>
<li>解释 <em>为什么</em> 会遇到问题</li>
<li>每一步都给出 <strong>完整命令</strong></li>
<li>出错时给出 <strong>排查思路</strong></li>
</ul>
</blockquote>
<hr>
<h2 id="0背景到底出啥问题">0 背景——到底出啥问题？</h2>
<ul>
<li>
<p>PVE 官方安装向导默认把虚拟机硬盘建在 <strong>LVM‑Thin</strong> 池（常见名字：<code>pve/data</code>）</p>
</li>
<li>
<p>LVM‑Thin 支持“超额分配”——给 VM 分了 500 G，其实物理磁盘只占用写入量</p>
</li>
<li>
<p>如果宿主机上的 LVM‑Thin 池快满了，最直接的症状是：</p>
<ul>
<li>宿主机无法写日志、Web 界面打不开</li>
<li>虚拟机也可能报各种 I/O 错误甚至宕机</li>
</ul>
</li>
</ul>
<p><strong>结论</strong>：一定要实时监控 <code>data_percent</code>（池已用百分比）。</p>
<hr>
<h2 id="1总体思路">1 总体思路</h2>
<table>
<thead>
<tr>
<th>步骤</th>
<th>作用</th>
<th>技术</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>写一个 <strong>检查脚本</strong> <code>lvm_check.sh</code>：返回 JSON，判定 OK / FAIL</td>
<td>Shell + jq + bc</td>
</tr>
<tr>
<td>B</td>
<td>写一个 <strong>推送脚本</strong> <code>lvm_kuma_push.sh</code>：把结果送到 Uptime Kuma</td>
<td>Shell + curl</td>
</tr>
<tr>
<td>C</td>
<td>在 Uptime Kuma 新建 <strong>Push 类型</strong> 监控</td>
<td>Web GUI</td>
</tr>
<tr>
<td>D</td>
<td>用 <strong>cron</strong> 定时执行推送脚本</td>
<td>Cron</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="2准备环境">2 准备环境</h2>
<ol>
<li><strong>登录宿主机</strong>（不是虚拟机！），确保拥有 root 权限。</li>
<li>安装用到的工具：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install -y jq bc curl
</span></span></code></pre></div><ol start="3">
<li>确认宿主机确实在用 LVM‑Thin：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>lvs -o lv_name,vg_name,pool_lv,data_percent --noheadings
</span></span></code></pre></div><p>若能看到 <code>pve/data</code> 且 <code>pool_lv</code> 字段为 <code>data</code>，就符合本文条件。</p>
<hr>
<h2 id="3步骤a编写检查脚本usrlocalbinlvm_checksh">3 步骤 A：编写检查脚本 <code>/usr/local/bin/lvm_check.sh</code></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /usr/local/bin/lvm_check.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># 判断 LVM‑Thin 池用量是否超过阈值（默认 90%）</span>
</span></span><span style="display:flex;"><span>THRESHOLD<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>
</span></span><span style="display:flex;"><span>output<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;status&#34;:&#34;ok&#34;,&#34;volumes&#34;:[]}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> read -r lv vg usage lsize pool; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  usage<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$usage<span style="color:#e6db74">&#34;</span> | tr -d <span style="color:#e6db74">&#39; %&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$pool<span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;data&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$usage<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$usage<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span>~ ^<span style="color:#f92672">[</span>0-9<span style="color:#f92672">]</span>+<span style="color:#f92672">(</span><span style="color:#ae81ff">\.</span><span style="color:#f92672">[</span>0-9<span style="color:#f92672">]</span>+<span style="color:#f92672">)</span>?$ <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$usage<span style="color:#e6db74"> &gt; </span>$THRESHOLD<span style="color:#e6db74">&#34;</span> | bc -l<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>      output<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$output<span style="color:#e6db74">&#34;</span> | jq <span style="color:#e6db74">&#39;.status=&#34;fail&#34;&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>      output<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$output<span style="color:#e6db74">&#34;</span> | jq --arg lv <span style="color:#e6db74">&#34;</span>$lv<span style="color:#e6db74">&#34;</span> --arg vg <span style="color:#e6db74">&#34;</span>$vg<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                                   --arg usage <span style="color:#e6db74">&#34;</span>$usage<span style="color:#e6db74">&#34;</span> --arg lsize <span style="color:#e6db74">&#34;</span>$lsize<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>          <span style="color:#e6db74">&#39;.volumes += [{&#34;lv&#34;:$lv,&#34;vg&#34;:$vg,&#34;usage&#34;:$usage,&#34;lsize&#34;:$lsize}]&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span> &lt; &lt;<span style="color:#f92672">(</span>lvs --noheadings -o lv_name,vg_name,data_percent,lv_size,pool_lv <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>             --units g --nosuffix<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;</span>$output<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chmod +x /usr/local/bin/lvm_check.sh
</span></span></code></pre></div><p><strong>手动测试</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/usr/local/bin/lvm_check.sh | jq
</span></span></code></pre></div><ul>
<li><code>status&quot;:&quot;ok&quot;</code> → 磁盘健康</li>
<li><code>status&quot;:&quot;fail&quot;</code> → JSON 里会列出超限卷</li>
</ul>
<hr>
<h2 id="4步骤c在uptimekuma创建-push监控">4 步骤 C：在 Uptime Kuma 创建 Push 监控</h2>
<ol>
<li>打开 Uptime Kuma Web 界面 → <strong>“New Monitor”</strong></li>
<li>选择 <strong>Type = Push</strong></li>
<li>取个名字（示例：<code>PVE‑LVM‑Disk</code>）</li>
<li>设置 <strong>Heartbeat Interval = 300 seconds</strong>（可改）</li>
<li>保存后，记录系统生成的 <strong>Push URL</strong>，形如：</li>
</ol>
<pre tabindex="0"><code>https://uptime.example.com/api/push/abcdef1234567890
</code></pre><hr>
<h2 id="5步骤b推送脚本把结果发给kuma">5 步骤 B：推送脚本把结果发给 Kuma</h2>
<h3 id="51将-pushurl-写进配置">5.1 将 Push URL 写进配置</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;PUSH_URL=&#34;https://uptime.example.com/api/push/abcdef1234567890&#34;&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | sudo tee /etc/lvm_check.conf
</span></span></code></pre></div><h3 id="52新脚本usrlocalbinlvm_kuma_pushsh">5.2 新脚本 <code>/usr/local/bin/lvm_kuma_push.sh</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /usr/local/bin/lvm_kuma_push.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># 向 Uptime Kuma 推送巡检结果</span>
</span></span><span style="display:flex;"><span>source /etc/lvm_check.conf
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$PUSH_URL<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">{</span> echo <span style="color:#e6db74">&#34;缺少 PUSH_URL&#34;</span>; exit 1; <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>/usr/local/bin/lvm_check.sh<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>status<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$result<span style="color:#e6db74">&#34;</span> | jq -r <span style="color:#e6db74">&#39;.status&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$status<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ok&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  curl -fsS --retry <span style="color:#ae81ff">3</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PUSH_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">?status=up&amp;msg=OK&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       --data-raw <span style="color:#e6db74">&#34;</span>$result<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  problem<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$result<span style="color:#e6db74">&#34;</span> | jq -c <span style="color:#e6db74">&#39;.volumes&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>  curl -fsS --retry <span style="color:#ae81ff">3</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PUSH_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">?status=down&amp;msg=</span><span style="color:#e6db74">${</span>problem<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       --data-raw <span style="color:#e6db74">&#34;</span>$result<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chmod +x /usr/local/bin/lvm_kuma_push.sh
</span></span></code></pre></div><p><strong>验证一次</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/usr/local/bin/lvm_kuma_push.sh
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 不报错即推送成功，Kuma 上应出现一次心跳</span>
</span></span></code></pre></div><hr>
<h2 id="6步骤d用cron定时执行">6 步骤 D：用 cron 定时执行</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo crontab -e
</span></span></code></pre></div><p>在文件末尾添加：</p>
<pre tabindex="0"><code class="language-cron" data-lang="cron">*/5 * * * * /usr/local/bin/lvm_kuma_push.sh &gt;/dev/null 2&gt;&amp;1
</code></pre><blockquote>
<p><strong>含义</strong>：每 5 分钟执行一次推送，与 Kuma 中的 300 s 间隔保持一致。</p>
</blockquote>
<p>保存退出后，可用 <code>sudo systemctl restart cron</code> （Debian 12）确保 cron 服务正在运行。</p>
<hr>
<h2 id="7如何验证整条链路">7 如何验证整条链路？</h2>
<ol>
<li>
<p>等 5‑10 分钟，看 Uptime Kuma 的 <em><strong>PVE‑LVM‑Disk</strong></em> 是否已变绿（Up）。</p>
</li>
<li>
<p>手动制造高使用率（或临时把脚本里 <code>THRESHOLD=90</code> 改成 <code>1</code>）再跑一次推送：</p>
<ul>
<li>Kuma 立即变红（Down），说明告警链路 OK。</li>
<li>改回 90 或释放空间，再推送一次，状态恢复 Up。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="8常见报错与排查">8 常见报错与排查</h2>
<table>
<thead>
<tr>
<th>报错/现象</th>
<th>原因 &amp; 解决</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jq: command not found</code></td>
<td>执行 <code>sudo apt install -y jq</code></td>
</tr>
<tr>
<td>Stderr: <code>curl: (28) Connection timed out</code></td>
<td>宿主机到 Kuma 网络不通；先 <code>curl -I $PUSH_URL</code> 测试</td>
</tr>
<tr>
<td>Kuma 页面显示 “No Heartbeat”</td>
<td>1) cron 未生效；2) PUSH_URL 写错；3) 脚本报错未推送（查 <code>/var/log/syslog</code>）</td>
</tr>
<tr>
<td><code>status&quot;:&quot;fail&quot;</code> 但 <code>.volumes</code> 为空</td>
<td>宿主机用的不是 LVM‑Thin；请用 <code>zfs list</code> 或其它方式监控</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="9后续可拓展">9 后续可拓展</h2>
<table>
<thead>
<tr>
<th>想法</th>
<th>方向</th>
</tr>
</thead>
<tbody>
<tr>
<td>图形化趋势</td>
<td>Kuma 的「Status Page」仅展示 Up/Down，可把 JSON 转 Prometheus 指标画曲线</td>
</tr>
<tr>
<td>邮件/钉钉通知</td>
<td>在 Kuma 的 <strong>Notification</strong> 里配置即可，脚本不用改</td>
</tr>
<tr>
<td>systemd‑timer</td>
<td>不喜欢 cron，可写 <code>lvm_kuma_push.timer</code>，精度更高</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="10总结">10 总结</h2>
<ol>
<li><strong>最小化依赖</strong>：只有 <code>jq bc curl</code>，脚本全放宿主机，虚拟机端零改动。</li>
<li><strong>告警及时</strong>：LVM‑Thin 池超过阈值立刻让 Uptime Kuma 变红并通知。</li>
<li><strong>步骤清晰</strong>：新手按本文复制‑粘贴即可复现，失败场景也给出了排错思路。</li>
</ol>
<p>希望这篇笔记能帮你 <strong>把“磁盘爆满恐惧”扼杀在摇篮里</strong>。如果你有更优雅的做法或遇到别的坑，欢迎评论区交流！</p>
        </div>
    </article>
    
    
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: ["margrop"],
      
      id: '\/post\/pve-host-virtual-machine-lvm-disk-space-mon',
      
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script>LA.init({id: "1vVTUWl7zoRjnKXi",ck: "1vVTUWl7zoRjnKXi"})</script>
    <script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script>
    <script>
      new LingQue.Monitor().init({id:"202teQt8THXwqyve"});
    </script>
</body>
</html>
