<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>如何使用Windows运行N2N-编译篇 - 魔都水滴</title>
<meta name="description" content="按照N2N官方网站的Building说明，Windows编译需要的软件有 Visual Studio,Cmake,OpenSSL。 看到Visual Studio我就头大，这个软件安装起来可不得了。 于是我选择了交叉编译，即使用Linux环境编译Windows的exe和dll文件。">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://blog.margrop.net/post/how-to-use-n2n-windows-compile/">

<meta property="og:site_name" content="魔都水滴">
<meta property="og:title" content="如何使用Windows运行N2N-编译篇 - 魔都水滴">
<meta property="og:description" content="按照N2N官方网站的Building说明，Windows编译需要的软件有 Visual Studio,Cmake,OpenSSL。 看到Visual Studio我就头大，这个软件安装起来可不得了。 于是我选择了交叉编译，即使用Linux环境编译Windows的exe和dll文件。">
<meta property="og:url" content="https://blog.margrop.net/post/how-to-use-n2n-windows-compile/">
<meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.margrop.net/images/avatar.png"><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="如何使用Windows运行N2N-编译篇 - 魔都水滴">
<meta name="twitter:description" content="按照N2N官方网站的Building说明，Windows编译需要的软件有 Visual Studio,Cmake,OpenSSL。 看到Visual Studio我就头大，这个软件安装起来可不得了。 于是我选择了交叉编译，即使用Linux环境编译Windows的exe和dll文件。"><meta name="twitter:image" content="https://blog.margrop.net/images/avatar.png"><meta property="article:published_time" content="2021-01-15T14:26:49&#43;08:00">
<meta property="article:modified_time" content="2021-01-15T14:26:49&#43;08:00"><meta property="article:tag" content="network"><meta property="article:tag" content="n2n"><meta property="article:tag" content="windows"><meta property="article:tag" content="tap"><meta property="article:tag" content="tapwindows"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"魔都水滴"},"dateModified":"2021-01-15T14:26:49+08:00","datePublished":"2021-01-15T14:26:49+08:00","description":"按照N2N官方网站的Building说明，Windows编译需要的软件有 Visual Studio,Cmake,OpenSSL。 看到Visual Studio我就头大，这个软件安装起来可不得了。 于是我选择了交叉编译，即使用Linux环境编译Windows的exe和dll文件。","headline":"如何使用Windows运行N2N-编译篇","mainEntityOfPage":"https://blog.margrop.net/post/how-to-use-n2n-windows-compile/","url":"https://blog.margrop.net/post/how-to-use-n2n-windows-compile/"}</script>
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; }
        nav a { margin-right: 15px; text-decoration: none; color: #333; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
        <a href="/">首页</a>
        <a href="/post/">归档</a>
        <a href="/tag/">标签</a>
    </nav>
    <article>
        <h1>如何使用Windows运行N2N-编译篇</h1>
        <div class="meta">
            发布时间: 2021-01-15
            
            | 标签: 
            
                
                <a href="/tag/network"><span class="tag">network</span></a>
            
                
                <a href="/tag/n2n"><span class="tag">n2n</span></a>
            
                
                <a href="/tag/windows"><span class="tag">windows</span></a>
            
                
                <a href="/tag/tap"><span class="tag">tap</span></a>
            
                
                <a href="/tag/tapwindows"><span class="tag">tapwindows</span></a>
            
            
        </div>
        <div class="content">
            <p>按照<a href="https://github.com/ntop/n2n">N2N官方网站</a>的<a href="https://github.com/ntop/n2n/blob/dev/doc/Building.md">Building说明</a>，Windows编译需要的软件有
<code>Visual Studio</code>,<code>Cmake</code>,<code>OpenSSL</code>。</p>
<p>看到<code>Visual Studio</code>我就头大，这个软件安装起来可不得了。
于是我选择了交叉编译，即使用Linux环境编译Windows的exe和dll文件。</p>
<h1 id="已编译好的文件">已编译好的文件</h1>
<blockquote>
<p>编译环境：
Ubuntu 20.04.1 LTS
Linux vm-n2n-cc2 5.4.0-59-generic #65-Ubuntu SMP Thu Dec 10 12:01:51 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</p>
</blockquote>
<blockquote>
<p><a href="https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/Windows/n2n_20210129.zip">一键打包下载</a>
含<code>edge</code>,<code>supernode</code>,<code>openssl链接库</code>(n2n运行必备),<code>tap-windows安装包</code>(n2n运行必备，Win7&amp;Win10)</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/Windows/edge.exe -O edge
</span></span><span style="display:flex;"><span>wget https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/Windows/supernode.exe -O supernode
</span></span><span style="display:flex;"><span>wget https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/Windows/libcrypto-1_1-x64.dll -O libcrypto-1_1-x64.dll
</span></span><span style="display:flex;"><span>wget https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/Windows/libssl-1_1-x64.dll -O libssl-1_1-x64.dll
</span></span></code></pre></div><h1 id="准备编译环境">准备编译环境</h1>
<ul>
<li>
<p>使用yum安装必要软件，下面是作者的参考文档</p>
<blockquote>
<p><a href="https://github.com/ntop/ntopng/blob/dev/doc/README.compilation">https://github.com/ntop/ntopng/blob/dev/doc/README.compilation</a></p>
</blockquote>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-get install mingw-w64
</span></span><span style="display:flex;"><span>apt-get install cmake
</span></span><span style="display:flex;"><span>apt-get install openssl
</span></span><span style="display:flex;"><span>apt-get install libssl-dev
</span></span><span style="display:flex;"><span>apt-get install build-essential git bison flex libxml2-dev libpcap-dev libtool libtool-bin rrdtool librrd-dev autoconf pkg-config automake autogen redis-server wget libsqlite3-dev libhiredis-dev libmaxminddb-dev libcurl4-openssl-dev libpango1.0-dev libcairo2-dev libnetfilter-queue-dev zlib1g-dev libssl-dev libcap-dev libnetfilter-conntrack-dev libreadline-dev libjson-c-dev libldap2-dev rename libsnmp-dev
</span></span></code></pre></div><h1 id="openssl交叉编译">OpenSSL交叉编译</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://www.openssl.org/source/openssl-1.1.1i.tar.gz
</span></span><span style="display:flex;"><span>tar -xvzf openssl-1.1.1i.tar.gz
</span></span><span style="display:flex;"><span>cd openssl-1.1.1i
</span></span><span style="display:flex;"><span>CROSS_COMPILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x86_64-w64-mingw32-&#34;</span>  ./Configure mingw64 no-asm -shared --prefix<span style="color:#f92672">=</span>/opt/toolchain/openssl/install-x86_64
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>make install
</span></span></code></pre></div><h1 id="下载n2n源代码">下载N2N源代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd ~
</span></span><span style="display:flex;"><span>git clone https://github.com/ntop/n2n
</span></span><span style="display:flex;"><span>cd n2n
</span></span><span style="display:flex;"><span>git checkout 2.8-stable
</span></span></code></pre></div><h1 id="n2n交叉编译准备">N2N交叉编译准备</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd ~/n2n
</span></span><span style="display:flex;"><span>vim toolChain.cmake
</span></span></code></pre></div><p>在<code>n2n</code>的目录下新建<code>toolChain.cmake</code>文件，并输入下面的配置内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>SET<span style="color:#f92672">(</span>CMAKE_SYSTEM_NAME Windows<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SET<span style="color:#f92672">(</span>CMAKE_CROSSCOMPILING TRUE<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SET<span style="color:#f92672">(</span>CMAKE_CROSSCOMPILER <span style="color:#e6db74">&#34;x86_64-w64-mingw32-&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SET<span style="color:#f92672">(</span>CMAKE_C_COMPILER <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CMAKE_CROSSCOMPILER<span style="color:#e6db74">}</span><span style="color:#e6db74">gcc&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SET<span style="color:#f92672">(</span>CMAKE_CXX_COMPILER <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CMAKE_CROSSCOMPILER<span style="color:#e6db74">}</span><span style="color:#e6db74">g++&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SET<span style="color:#f92672">(</span>CMAKE_FIND_ROOT_PATH /opt/toolchain/openssl/install-x86_64<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SET<span style="color:#f92672">(</span>CMAKE_VERBOSE_MAKEFILE on<span style="color:#f92672">)</span>
</span></span></code></pre></div><h1 id="n2n交叉编译">N2N交叉编译</h1>
<p>使用<code>CMake</code>对<code>n2n</code>进行交叉编译</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir build
</span></span><span style="display:flex;"><span>cd build
</span></span><span style="display:flex;"><span>cmake -DCMAKE_TOOLCHAIN_FILE<span style="color:#f92672">=</span>../toolChain.cmake ..
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><h1 id="安装tapwindows-9242">安装TapWindows 9.24.2</h1>
<p><a href="http://build.openvpn.net/downloads/releases/tap-windows-9.24.2-I601-Win7.exe">官方下载 For Win7</a>
<a href="http://build.openvpn.net/downloads/releases/tap-windows-9.24.2-I601-Win10.exe">官方下载 For Win10</a>
<a href="https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/Windows/tap-windows-9.24.2-I601-Win7.exe">本站下载 For Win7</a>
<a href="https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/Windows/tap-windows-9.24.2-I601-Win10.exe">本站下载 For Win10</a></p>
<h1 id="可选同一机器如何启动多个edge节点">可选，同一机器如何启动多个edge节点</h1>
<ul>
<li>访问Windows机器的Tap-Windows安装目录，默认为<code>C:\Program Files\TAP-Windows\bin</code>，该目录下面有个<code>addtap.bat</code>文件，反复执行这个<code>addtap.bat</code>文件，即可在Windowsv中添加多个虚拟网卡。在<code>网络和共享中心</code>里面的<code>更改适配器设置</code>里面可以看到多个虚拟网卡。</li>
<li>如果虚拟网卡太多了，也可以删除，进入<code>设备管理器</code> ，删除不需要的虚拟网卡即可。</li>
</ul>
        </div>
    </article>
    
    
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: "[\"margrop\"]",
      id: '340ac22ae9016063993a740b208cad9217b7cd45',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
</body>
</html>
