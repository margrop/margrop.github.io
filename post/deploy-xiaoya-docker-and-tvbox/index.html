<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>【转】如何设置xiaoya的docker，及tvbox配置 - 魔都水滴</title>
<meta name="description" content="文章来源：https://xiaoyaliu.notion.site/xiaoya-docker-69404af849504fa5bcf9f2dd5ecaa75f 如何设置xiaoya的docker 要获得最新小雅的资讯请关注小雅的tg频道 https://t.me/xiaoyaliu 平时有什么使用上遇到的困难可以来 …">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://blog.margrop.net/post/deploy-xiaoya-docker-and-tvbox/">

<meta property="og:site_name" content="魔都水滴">
<meta property="og:title" content="【转】如何设置xiaoya的docker，及tvbox配置 - 魔都水滴">
<meta property="og:description" content="文章来源：https://xiaoyaliu.notion.site/xiaoya-docker-69404af849504fa5bcf9f2dd5ecaa75f 如何设置xiaoya的docker 要获得最新小雅的资讯请关注小雅的tg频道 https://t.me/xiaoyaliu 平时有什么使用上遇到的困难可以来 …">
<meta property="og:url" content="https://blog.margrop.net/post/deploy-xiaoya-docker-and-tvbox/">
<meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.margrop.net/images/avatar.png"><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="【转】如何设置xiaoya的docker，及tvbox配置 - 魔都水滴">
<meta name="twitter:description" content="文章来源：https://xiaoyaliu.notion.site/xiaoya-docker-69404af849504fa5bcf9f2dd5ecaa75f 如何设置xiaoya的docker 要获得最新小雅的资讯请关注小雅的tg频道 https://t.me/xiaoyaliu 平时有什么使用上遇到的困难可以来 …"><meta name="twitter:image" content="https://blog.margrop.net/images/avatar.png"><meta property="article:published_time" content="2024-04-30T21:18:55&#43;08:00">
<meta property="article:modified_time" content="2024-04-30T21:18:55&#43;08:00"><meta property="article:tag" content="docker"><meta property="article:tag" content="xiaoya"><meta property="article:tag" content="tvbox"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"魔都水滴"},"dateModified":"2024-04-30T21:18:55+08:00","datePublished":"2024-04-30T21:18:55+08:00","description":"文章来源：https://xiaoyaliu.notion.site/xiaoya-docker-69404af849504fa5bcf9f2dd5ecaa75f 如何设置xiaoya的docker 要获得最新小雅的资讯请关注小雅的tg频道 https://t.me/xiaoyaliu 平时有什么使用上遇到的困难可以来 …","headline":"【转】如何设置xiaoya的docker，及tvbox配置","mainEntityOfPage":"https://blog.margrop.net/post/deploy-xiaoya-docker-and-tvbox/","url":"https://blog.margrop.net/post/deploy-xiaoya-docker-and-tvbox/"}</script>
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        nav a { margin-right: 20px; text-decoration: none; color: #333; font-size: 16px; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
  <a href="/">首页</a>
  <a href="/post/">归档</a>
  <a href="/tags/">标签</a>
  <a href="/post/about">关于</a>
  <a href="https://download.margrop.net" target="_blank">下载</a>
  <a href="/post/favorites">Link</a>
  <a href="/post/github-project-stars">Github</a>
  <a href="https://github-mirrors.margrop.net" target="_blank">Github加速</a>
  <a href="https://status.anye.xyz/" target="_blank">Docker加速</a>
</nav>

    <article>
        <h1>【转】如何设置xiaoya的docker，及tvbox配置</h1>
        <div class="meta">
            发布时间: 2024-04-30
            
            | 标签: 
            
                
                <a href="/tag/docker"><span class="tag">docker</span></a>
            
                
                <a href="/tag/xiaoya"><span class="tag">xiaoya</span></a>
            
                
                <a href="/tag/tvbox"><span class="tag">tvbox</span></a>
            
            
        </div>
        <div class="content">
            <p>文章来源：<a href="https://xiaoyaliu.notion.site/xiaoya-docker-69404af849504fa5bcf9f2dd5ecaa75f">https://xiaoyaliu.notion.site/xiaoya-docker-69404af849504fa5bcf9f2dd5ecaa75f</a></p>
<h1 id="如何设置xiaoya的docker">如何设置xiaoya的docker</h1>
<p>要获得最新小雅的资讯请关注小雅的tg频道 <a href="https://t.me/xiaoyaliu">https://t.me/xiaoyaliu</a></p>
<p>平时有什么使用上遇到的困难可以来这里找我或其他人帮助 <a href="https://t.me/PlutoPlayer">https://t.me/PlutoPlayer</a></p>
<hr>
<p><strong>目录</strong></p>
<hr>
<h1 id="你需要什么才能安装-xiaoya-的docker">你需要什么才能安装 xiaoya 的docker</h1>
<ol>
<li>软路由盒子类似 n1 等，具有 openwrt环境 （可以终端上一键配置）</li>
<li>NAS 等具有docker插件 （无法或很难登入终端，需要图形化自行配置）</li>
<li>云服务器也就是俗称的 vps （可以终端上一键配置）</li>
</ol>
<h1 id="如何安装">如何安装</h1>
<h2 id="openwrt或者vps下安装调出终端命令行">openwrt或者vps下安装，调出终端命令行</h2>
<p>openwrt控制面板左侧（“系统”或“服务”下找到“TTY终端”）</p>
<p>ssh 登入 openwrt</p>
<p>然后一键安装</p>
<blockquote>
<p><strong>bash -c &ldquo;$(curl <a href="http://docker.xiaoya.pro/update_new.sh)%22">http://docker.xiaoya.pro/update_new.sh)&quot;</a></strong></p>
</blockquote>
<p>如果是用host模式安装，则用</p>
<blockquote>
<p>bash -c &ldquo;$(curl <a href="http://docker.xiaoya.pro/update_new.sh)%22">http://docker.xiaoya.pro/update_new.sh)&quot;</a> -s host</p>
</blockquote>
<p>第一次安装会出现下面的显示</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35705642/1681315779992-b1438f74-68d3-4fa8-9fa5-ba0dd5ad06fe.png" alt="Untitled"></p>
<p>你需要配置好三个必要参数再安装：</p>
<table>
<thead>
<tr>
<th></th>
<th>对应文件</th>
<th>获取方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>/etc/xiaoya/mytoken.txt</td>
<td><a href="https://aliyuntoken.vercel.app/">https://aliyuntoken.vercel.app/</a> <a href="https://alist.nn.ci/zh/guide/drivers/aliyundrive.html">https://alist.nn.ci/zh/guide/drivers/aliyundrive.html</a></td>
</tr>
<tr>
<td>open token</td>
<td>/etc/xiaoya/myopentoken.txt</td>
<td><a href="https://alist.nn.ci/zh/guide/drivers/aliyundrive_open.html">https://alist.nn.ci/zh/guide/drivers/aliyundrive_open.html</a></td>
</tr>
<tr>
<td>转存目录的folder id</td>
<td>/etc/xiaoya/temp_transfer_folder_id.txt</td>
<td>先转存这个https://www.aliyundrive.com/s/rP9gP3h9asE  到自己网盘（选择资源盘），然后浏览器打开转存后的目录，浏览器的url <a href="https://www.aliyundrive.com/drive/file/resource/640xxxxxxxxxxxxxxxxxxxca8a">https://www.aliyundrive.com/drive/file/resource/640xxxxxxxxxxxxxxxxxxxca8a</a> 最后一串就是，记得这个目录不要删，里面的内容可以定期删除</td>
</tr>
</tbody>
</table>
<p>参考视频</p>
<p><a href="http://img.xiaoya.pro/">http://img.xiaoya.pro/</a>教程.mp4</p>
<p>配置的内容和格式参考 “<strong>容器内 /data 目录的文件功能说明</strong>” 章节，有些平台需要额外在服务器的防火墙上开放端口，选择放行 5678或者6789端口</p>
<h2 id="nas-下图形配置安装">NAS 下图形配置安装</h2>
<p>请参照下面的 群晖配置截图，其它NAS产品的配置大同小异</p>
<p>详见 <a href="http://alist.xiaoya.pro/">http://alist.xiaoya.pro/安装，配置，修复%20xiaoya%20docker%20指南/群晖NAS%20Docker安装xiaoya.pdf</a></p>
<p><img src="/post-images/xiaoya_alist_docker/aa.jpg" alt="aa.jpg"></p>
<p><img src="/post-images/xiaoya_alist_docker/bb.jpg" alt="bb.jpg"></p>
<p>有的群晖因为固件原因，装载路径是 /data 保存应用会失败，那么尝试这样</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(1).png" alt="Untitled"></p>
<p>这是unraid的配置参考</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(2).png" alt="Untitled"></p>
<p><strong>记住 端口映射是 5678 → 80 不是 <del>5244</del></strong>  不然搜索会失效，出现下面的错误</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(3).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(4).png" alt="Untitled"></p>
<h2 id="额外功能">额外功能</h2>
<ol>
<li>自动签到</li>
<li>检查token有效性工具</li>
<li>配合TVBOX 的json文件，可以搜索xiaoya的docker内容</li>
<li>挂载自定义的pikpak分享</li>
<li>挂载自己的多个pikpak网盘</li>
<li>挂载自定义的阿里分享资源</li>
</ol>
<h1 id="设置强制登入和自定义密码">设置强制登入，和自定义密码</h1>
<p>把密码保存到 /etc/xiaoya/guestpass.txt （不过不要设置稀奇古怪的符号，例如；&amp;#“~@（）*$  之类的）</p>
<p>如果你的xiaoya放在公网，为了防止别人蹭网，可以设置强制登入，新增 /etc/xiaoya/guestlogin.txt 这个文件，重启即可，文件有没有内容无所谓，如果取消强制登入就删除这个文件。强制登入的账号为 dav，密码使用 /etc/xiaoya/guestpass.txt 里设置的，同时webdav连接使用 dav 这个用户</p>
<p>上述2个功能设置好后需要重启docker才会生效。</p>
<h1 id="容器内-data-目录的文件功能说明">容器内 /data 目录的文件功能说明：</h1>
<p>标注******* 的文件为必要，必须存在和有内容，所有的配置文件缺省位置在宿主机的 /etc/xiaoya</p>
<p><strong>文件</strong>：**mytoken.txt *****
用途：用来加载阿里分享，和自动签到
格式：75fee1ca79514e60aa6d46c8370b9afd
备注：32位长度，参考 <a href="https://t.me/PlutoPlayer/239324">https://t.me/PlutoPlayer/239324</a></p>
<p><strong>文件</strong>：**myopentoken.txt *****
用途：用来加载自己的阿里云盘（open接口）
格式：eyJ0eXAiOixxxxxLCJhbGciOiJSUzI1NiJ9.eyJzd999999wNzBkOWRiNWQ5YmQ0YT&hellip;&hellip;..
备注：很长一串，280位，获取方式 <a href="https://alist.nn.ci/zh/guide/drivers/aliyundrive_open.html">https://alist.nn.ci/zh/guide/drivers/aliyundrive_open.html</a></p>
<p><strong>文件</strong>：**temp_transfer_folder_id.txt *****
用途：你的阿里网盘的转存目录的folder id
格式：640xxxxxxxxxxxxxxxxxxxca8a
备注：打开你阿里云盘网页，目录所在的浏览器地址 <a href="https://www.aliyundrive.com/drive/folder/640xxxxxxxxxxxxxxxxxxxca8a">https://www.aliyundrive.com/drive/folder/640xxxxxxxxxxxxxxxxxxxca8a</a>   最后一串就是</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(5).png" alt="Untitled"></p>
<p><strong>如果你升级到了阿里云盘app 4.9或以上</strong>，那么整个账号的设置会有大改动，你需要在新的“资源库”创建一个目录，先转存这个</p>
<p><a href="https://www.aliyundrive.com/s/rP9gP3h9asE">https://www.aliyundrive.com/s/rP9gP3h9asE</a></p>
<p>然后打开浏览器，打开转存后的目录，在浏览器的url里获取folder id</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(6).png" alt="Untitled"></p>
<p>文件：pikpak.txt
用途：用来观看pikpak分享
格式：&ldquo;xxxxxxxx&rdquo; &ldquo;yyyyyyyy&rdquo;
备注：账号可以是邮箱和手机号，手机号前面要加区号，也就是 &ldquo;+86xxxx&rdquo; 这样，注册如果用谷歌快捷方式登入的话是无法使用谷歌邮箱登入的（alist不支持）</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(7).png" alt="Untitled"></p>
<p><strong>文件：guestpass.txt</strong>
用途：自己修改 guest 账号的密码
备注：如果开启了强制登入则 登入账号 dav 也使用此密码</p>
<p><strong>文件：guestlogin.txt</strong>
用途：通过此文件的存在与否来决定是否开启强制登入
格式：空白文件，不需要强制登入功能，则删除此文件</p>
<p><strong>文件：show_my_ali.txt</strong>
用途：通过此文件的存在与否来决定是否加载自己的阿里云盘
格式：空白文件，不需要加载的，则删除此文件</p>
<p><strong>文件：docker_address.txt</strong>
用途：配合 TVBOX的alist搜索
格式：http://xxxxx:5678   （最后不要加 /)</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(8).png" alt="Untitled"></p>
<p>TVBOX 配置地址 http://xxxxx:5678/tvbox/my.json
TVBOX 配置地址（多仓，需要TVBox壳支持） http://xxxxx:5678/tvbox/juhe.json</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(9).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(10).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(11).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(12).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(13).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(14).png" alt="Untitled"></p>
<p><strong>文件：docker_address_ext.txt</strong>
用途：外网地址，配合tvbox外网访问，对应的配置地址是 http://xxxx/tvbox/my_ext.json
格式：http://xxxxx:5678   （最后不要加 /)</p>
<p><strong>文件：iptv.m3u</strong>
用途：在my.json中自定义额外的直播源 &ldquo;我的私用”
格式：标准的m3u格式</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(15).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(16).png" alt="Untitled"></p>
<p><strong>文件：tv.txt</strong>
用途：挂载自定义直播源到xiaoya
格式：tvbox的直播源格式，如图所示</p>
<p>备注：直播源有格式，区域限制等问题，有的可以在网页观看，有的需要用播放器才能看</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(17).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(18).png" alt="Untitled"></p>
<p><strong>文件：proxy.txt</strong>
用途：使用代理，http，https，socks5 协议
格式：http://xxxxx:7890  或 socks5://xxxxx:7891 （最后不要加 /)</p>
<p><strong>文件：alist_token_expire_time.txt</strong>
用途：设置alist auth token的有效期，缺省4800（对于无所谓安全的用户来说方便）
格式：72 （数字，单位是小时)</p>
<p><strong>文件：alist_auth_token.txt</strong>
用途：无需设置，自动生成，可以用来配置alist v3方式套娃，删除后会重新生成一个新的
格式：alist-09ceb38a-f143-47f7-b255-c3eec819cd7bxxxxxxxxxxxxx</p>
<p><strong>文件：tvbox_security.txt</strong>
用途：开启tvbox的随机订阅地址，防止公网上被人蹭，让别人猜不到你的订阅地址
格式：空白文件，没有则不开启</p>
<p><strong>文件：tvbox_config.txt</strong>
用途：无需设置，自动生成，
格式：http://xxxxx:5678/tvbox/sdfh02ye.my.txt</p>
<p><strong>文件：tvbox_config_ext.txt</strong>
用途：无需设置，自动生成，外网的随机订阅地址，
格式：http://xxxxx:5678/tvbox/sdfh02ye.my_ext.txt</p>
<p><strong>文件：my.json</strong>
用途： 自定义tvbox配置文件
格式： TVBOX 兼容的json配置文件格式</p>
<p><strong>文件：pikpak_list.txt</strong>
用途：挂载自己一个或多个 pikpak账号
格式：挂载名  &ldquo;账号&rdquo; &ldquo;密码&rdquo;  ，用空格分开（pikpak2  “abc@hotmail.com&rdquo; &ldquo;123456&rdquo;），每行一个</p>
<p>备注：挂载名不能有空格</p>
<p><strong>文件：alist_list.txt</strong>
用途：挂载一个或多个 Alist 套娃
格式：挂载名  alist版本（v2或v3）网址 目录，用空格分开每行一个
备注：挂载名不能有空格，网址最后不要有斜杠</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(18).png" alt="Untitled"></p>
<p><strong>文件：pikpakshare_list.txt</strong>
用途：挂载自己一个或多个 pikpak分享
格式：挂载名  分享ID 分享目录  ，用空格分开（赵霸道  VNRT8Wr8BGyw1kt1HkijKR4Qo1  VNQf6ZmWE3pVWGpuFriGqyPzo1），每行一个
备注：挂载名不能有空格</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(19).png" alt="Untitled"></p>
<p><strong>文件：alishare_list.txt</strong>
用途：挂载自定义分享ID
格式：挂载名 阿里分享ID 文件folder id，用空格分开，每行一个
120T电影资源     ZpevUcDZ2Pn  636c8ba0703acd24cd44b19dd00312ef15b1e8
60T各种资料       s6NBDauc5VZ  63b16e82a50ca34f6c7466293235a06d1af8ea3</p>
<p>备注：挂载名不能有空格</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(20).png" alt="Untitled"></p>
<p>另外提醒一下，不同平台导致的文本文件格式有差别，确保是 unix格式，utf-8编码，不然会出现乱码，网页报错，无法进入目录等奇奇怪怪的问题，看截图，确保编码格式正确</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(21).png" alt="Untitled"></p>
<p><strong>示范配置文件</strong></p>
<p><a href="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4ddd2d7d-46c5-4893-b7ca-85cbfbdf3b65/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%8C%83%E4%BE%8B.zip">配置文件范例.zip</a></p>
<h1 id="配置好了docker但是浏览器访问不了怎么办"><strong>配置好了docker，但是浏览器访问不了怎么办</strong></h1>
<h3 id="无法打开页面"><strong>无法打开页面</strong></h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(22).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(23).png" alt="Untitled"></p>
<p>最简单就是用host模式（端口6789）安装一次，可以规避桥接模式遇到防火墙规则冲突等问题</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">bash</span> <span style="color:#960050;background-color:#1e0010">-c</span> <span style="color:#e6db74">&#34;$(curl -s http://docker.xiaoya.pro/update_new.sh)&#34;</span> <span style="color:#960050;background-color:#1e0010">-s</span> <span style="color:#960050;background-color:#1e0010">host</span>
</span></span></code></pre></div><h3 id="启动加载慢"><strong>启动加载慢</strong></h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(24).png" alt="Untitled"></p>
<p>请先检查alist所在设备的网络连接情况，</p>
<p>正常的加载时间是在1分钟-5分钟内，如果超过5分钟，那么可能有问题了，检查日志</p>
<p>docker logs -f xiaoya</p>
<p>如果看到</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(25).png" alt="Untitled"></p>
<p>那么就是触发了alist的open接口的限制</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(26).png" alt="Untitled"></p>
<p>那你需要暂停一小时，停止所有alist相关的镜像</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">docker</span> <span style="color:#960050;background-color:#1e0010">stop</span> <span style="color:#960050;background-color:#1e0010">xiaoya</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">docker</span> <span style="color:#960050;background-color:#1e0010">stop</span> <span style="color:#960050;background-color:#1e0010">xiaoya-hostmode</span>  <span style="color:#960050;background-color:#1e0010">（如果是host模式安装的镜像）</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">docker</span> <span style="color:#960050;background-color:#1e0010">stop</span> <span style="color:#960050;background-color:#1e0010">alist</span>
</span></span></code></pre></div><p>一小时后再开启这些镜像</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">docker</span> <span style="color:#960050;background-color:#1e0010">start</span> <span style="color:#960050;background-color:#1e0010">xiaoya</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">docker</span> <span style="color:#960050;background-color:#1e0010">start</span> <span style="color:#960050;background-color:#1e0010">alist</span>
</span></span></code></pre></div><p>或者可以通过科学 上网切换节点的方式变更IP来规避这个限制（因为它是以IP计算的）</p>
<h3 id="出现-the-input-paramter-refresh_token-is-not-valid">出现 “The input paramter refresh_token is not valid”</h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(27).png" alt="Untitled"></p>
<p>替换token， mytoken.txt 那个32位长的token</p>
<h3 id="如何修复"><strong>如何修复</strong></h3>
<p>curl <a href="http://docker.xiaoya.pro/version.txt">http://docker.xiaoya.pro/version.txt</a>
看看有没有获取到版本号</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(28).png" alt="Untitled"></p>
<p>如果没有获取到版本号，那么就是网络问题，先解决网络联通的问题。</p>
<p>如果上面检测能获取版本号，说明网络没问题，那么就大概率是防火墙的问题，有可能是其它软件干扰了docker的防火墙规则，可以这样尝试修复docker防火墙规则</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">service</span> <span style="color:#960050;background-color:#1e0010">dockerd</span> <span style="color:#960050;background-color:#1e0010">restart</span>
</span></span></code></pre></div><p>或者 （视乎你的系统）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">systemctl</span> <span style="color:#960050;background-color:#1e0010">restart</span> <span style="color:#960050;background-color:#1e0010">docker</span>
</span></span></code></pre></div><p>目的是重启 Docker Daemon管理进程来重建docker 防火墙规则，然后再</p>
<blockquote>
<p>docker restart xiaoya</p>
</blockquote>
<p>如果还是不行，那要使出终极大招了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">iptables</span> <span style="color:#960050;background-color:#1e0010">-F</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">service</span> <span style="color:#960050;background-color:#1e0010">dockerd</span> <span style="color:#960050;background-color:#1e0010">restart</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">docker</span> <span style="color:#960050;background-color:#1e0010">restart</span> <span style="color:#960050;background-color:#1e0010">xiaoya</span>
</span></span></code></pre></div><p>依次执行</p>
<h1 id="阿里的风控">阿里的风控</h1>
<p>阿里更新了接口，有好几个人都出现一会儿能放一会儿不能放的情况，共同点就是都是使用infuse，然后在刮削扫描，那么综合起来，可以判断出阿里对短时间同IP大量请求会出现限制，</p>
<p>表现在网页就是出现 ParamFlowException</p>
<p>表现在播放器就是500错误</p>
<p>大家留意一下，尽量停掉扫描，过一会而会自动好</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(29).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(30).png" alt="Untitled"></p>
<p>所以现在不要刮削，阿里开始动态连接管理了，短时间大量请求直接抛出错误，长时间不确定会怎么处理，肯定对token和账号会做出限制，因为从被连接放来说，看起来就像流量攻击，我之前防止别人对我的网站建索引也是采用差不多的手段</p>
<p>现在下面这些行为就变成了高危操作</p>
<ol>
<li>使用infuse等缺省设置进行扫描获取元数据</li>
<li>使用kodi，plex，jellyfin，emby进行刮削</li>
<li>使用alist进行建索引</li>
</ol>
<p>一定要小心不要让短期限制变成对你账户的长期限制，停止上述3种行为</p>
<h1 id="什么软件可以连接-xiaoya-">什么软件可以连接 xiaoya ？</h1>
<h3 id="文件管理类型"><strong>文件管理类型</strong>：</h3>
<ul>
<li>ES文件浏览器，Solid Explorer</li>
</ul>
<h3 id="视频播放器"><strong>视频播放器</strong>：</h3>
<ul>
<li>IOS 平台： infuse， fileball，nplayer</li>
<li>安卓平台： nplayer， Kodi， Reex， NovaPlayer（魔改版）</li>
<li>windows： potplayer</li>
</ul>
<h3 id="挂载到本地目录"><strong>挂载到本地目录</strong>：</h3>
<ul>
<li>rclone，davfs2，raidrive，Mountain Duck</li>
</ul>
<h1 id="如何在播放器上通过webdav-连接-xiaoya的-docker">如何在播放器上通过webdav 连接 xiaoya的 docker</h1>
<p>参考 potplayer, nplayer, kodi 的配置截图</p>
<p><strong>webdav 账号密码</strong></p>
<p>用户: guest</p>
<p>密码: guest_Api789</p>
<h3 id="potplayer"><strong>potplayer</strong></h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(31).png" alt="Untitled"></p>
<h3 id="nplayer"><strong>nplayer</strong></h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(32).png" alt="Untitled"></p>
<h3 id="kodi"><strong>Kodi</strong></h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(33).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(34).png" alt="Untitled"></p>
<h3 id="nova-魔改版支持webdavhttpstmeplutoplayer127849-"><strong>Nova 魔改版</strong>（支持webdav，https://t.me/PlutoPlayer/127849 ）</h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(35).png" alt="Untitled"></p>
<h3 id="infuse">infuse</h3>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(36).png" alt="Untitled"></p>
<h3 id="tvbox">TVBOX</h3>
<p>把你的docker url 填写进 docker_address.txt （缺省在 /etc/xiaoya 目录下）</p>
<p>比如 http://192.168.2.1:5678</p>
<p>在TVBOX 的配置地址填入 http://192.168.2.1:5678/tvbox/my.json</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(37).png" alt="Untitled"></p>
<p>可以支持xiaoya的搜索</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(38).png" alt="Untitled"></p>
<p>也可以用浏览的方式</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(39).png" alt="Untitled"></p>
<p>如何想自定义配置的json文件，则放置在 /etc/xiaoya/my.json 即可</p>
<h1 id="如何配置自己的token">如何配置自己的token</h1>
<h3 id="阿里token">阿里token</h3>
<p>****<a href="https://alist.nn.ci/zh/guide/drivers/aliyundrive.html">https://alist.nn.ci/zh/guide/drivers/aliyundrive.html</a>    或</p>
<p><a href="https://aliyundriver-refresh-token.vercel.app/">https://aliyundriver-refresh-token.vercel.app/</a></p>
<p>获取你的移动端token</p>
<p>然后，在终端命令行 （xxxxxxxxxxxxxxxx 就是你获取的token）</p>
<p><strong>echo xxxxxxxxxxxxxxxxxxxxxx &gt; /etc/xiaoya/mytoken.txt</strong></p>
<p>或者将你自己获取到的token粘贴至 etc/xiaoya/mytoken.txt文件里并保存。</p>
<p>NAS或者其它自行配置的请放入自己在配置中设定的文件夹中，文件名是 mytoken.txt</p>
<p>记住一定要是移动端获取的，并且是32位长度</p>
<p>是否正确放置了进去，可以通过下面指令来确认</p>
<p>docker exec -it xiaoya cat /data/mytoken.txt</p>
<h3 id="pikpak-账号">Pikpak 账号</h3>
<p>把你的pikpak账号 保存到 /etc/xiaoya/pikpak.txt</p>
<p>格式如下：</p>
<p><a href=""></a></p>
<p>&ldquo;xxx&rdquo; &ldquo;yyy&rdquo; （将xxx替换为账号，yyy替换为为密码，&ldquo;账号&rdquo; &ldquo;密码&quot;中间有空格，切记引号要英文字符的，是 &quot; 不是 “）</p>
<p>如果账号是手机号，要 +区号 ，比如你的手机号 12345678900 ，那么就填 “+8612345678900”</p>
<p>通过第三方认证注册的（比如谷歌），请留意看 <em>“我的账号填对了，为什么还看不到pikpak目录下的内容”</em> 的内容</p>
<p><strong><a href="https://toapp.mypikpak.com/activity/invited?code=73900974">注册开通PikPak请点击 注册</a></strong></p>
<p>注册2个账号，一个用来存，一个用来看</p>
<p>注册后在 如图所示位置输入”<strong>兑换码</strong>“ <strong>73900974</strong> 既可获得5天的试用会员资格，然后你利用5天时间去把空间塞满，5天会员到期后内容不会被删除，只能看不能存，这个账号也会被限速，你就把它当作分享盘（分享给自己的另一个账号或别人）</p>
<p>注册另一个账号，不要存超过6G的东西，只要不超过基本会员的免费6G空间，就可以不限速，这个用来看别人的分享或者自己的另一个账号的分享</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(40).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(41).png" alt="Untitled"></p>
<p>注册尽量利用邮箱注册，这个就可以注册很多个</p>
<p>如果出现下面几个这样的图示，则表示你需要科学上网，有的地区可以直连，有的地区不行</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(42).png" alt="Untitled"></p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(43).png" alt="Untitled"></p>
<h3 id="如何确认自己的pikpak账号设置了没有"><strong>如何确认自己的pikpak账号设置了没有？</strong></h3>
<p>通过下面指令来确定</p>
<p>docker exec -it xiaoya cat /data/pikpak.txt</p>
<h3 id="我的账号填对了为什么还看不到pikpak目录下的内容">我的账号填对了，为什么还看不到pikpak目录下的内容？</h3>
<p>如果不是账号密码填错，那么我猜你是这样的情况，注册的时候使用了google，FB等第三方快捷注册，虽然看起来账号是谷歌邮箱，但实际上是不能用邮箱登入，而必须使用第三方验证，alist现在还不支持这种跳转到第三方的验证，所以你要么在账号设置里绑定一个邮箱，或者重新注册一个新账号</p>
<p>你可以自己验证一下，选择邮箱登入，输入你的gmail邮箱看行不行</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(44).png" alt="Untitled"></p>
<h3 id="如何测试我的alist能够联通pikpak服务器"><strong>如何测试我的alist能够联通pikpak服务器？</strong></h3>
<p>在alist所在的设备命令行输入</p>
<p>curl <a href="https://inapp.mypikpak.com/ping">https://inapp.mypikpak.com/ping</a></p>
<p>如果出现一大堆内容，则表示能联通pikpak，反之则否</p>
<h1 id="播放不了视频怎么办视频有画面没声音怎么办">播放不了视频怎么办，视频有画面没声音怎么办？</h1>
<p>如果是用浏览器有的能放，有的不能放，那么大概率是浏览器视频解码能力不足，请调用第三方播放器尝试，或者通过webdav连接alist来播放（一般浏览器不支持 H.265 和  AC3 编码视频）</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(45).png" alt="Untitled"></p>
<h1 id="出现了磁盘满了故障排查怎么办"><strong>出现了“磁盘满了，故障排查”怎么办</strong></h1>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(46).png" alt="Untitled"></p>
<p>有这几种可能：</p>
<ol>
<li>你的网盘满了</li>
<li>token 或者 opentoken失效</li>
<li>无法刷新opentoken（60分钟10次的限制）</li>
<li>token和opentoken不是一个账号的</li>
<li>你删除了转存目录（即使你再重新创建一个同名的也没用，folder id变了）</li>
</ol>
<h1 id="alist-v3-无法套娃挂载-xiaoya-怎么办">Alist V3 无法套娃挂载 xiaoya 怎么办？</h1>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(47).png" alt="Untitled"></p>
<p>执行下面代码获取令牌</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">docker</span> <span style="color:#960050;background-color:#1e0010">exec</span> <span style="color:#960050;background-color:#1e0010">-i</span> <span style="color:#960050;background-color:#1e0010">xiaoya</span> <span style="color:#960050;background-color:#1e0010">sqlite</span><span style="color:#ae81ff">3</span> <span style="color:#960050;background-color:#1e0010">data/data.db</span> <span style="color:#960050;background-color:#1e0010">&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">select</span> <span style="color:#960050;background-color:#1e0010">value</span> <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#960050;background-color:#1e0010">x_setting_items</span> <span style="color:#960050;background-color:#1e0010">where</span> <span style="color:#960050;background-color:#1e0010">key</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#e6db74">&#34;token&#34;</span><span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">EOF</span>
</span></span></code></pre></div><p>把令牌填到 Authorization， Server 选用本地的docker 地址，不要填账号和密码</p>
<h1 id="如果我布署在vps上会不会消耗我的流量">如果我布署在vps上会不会消耗我的流量？</h1>
<p>302重定向和本地代理的差别是什么？</p>
<p>假设：</p>
<ul>
<li>A 是播放器</li>
<li>B 是alist</li>
<li>C 是阿里</li>
</ul>
<p>302：
A访问B，B告诉A，你要的东西在C那里，我给你个地址，你直接找C，然后A直连C</p>
<pre><code>   因为 A 最好播放的时候直接连 C了，所以不消耗 B的流量，也就是B所在的vps流量
</code></pre>
<p>本地代理：
A访问B，B去访问C，把内容取回来，直接返回A，B做了中间人做转发</p>
<pre><code>   B 在C的播放过程中消耗了 从C取内容（拉）+ 传给A （推），一进一出的流量
</code></pre>
<p>我以这个资源为例做具体说明</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(48).png" alt="Untitled"></p>
<p>复制连接得到的是</p>
<p><strong><a href="http://alist.xiaoya.pro/d/">http://alist.xiaoya.pro/d/</a>音乐/流行/自听无损音乐545首%20全部有封面歌词/王忻辰、苏星婕%20-%20清空.flac</strong></p>
<p>连接这个url得到第一个跳转</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(49).png" alt="Untitled"></p>
<p><a href="https://pdsapi.aliyundrive.com/v2/redirect?id=73e8b1fe5c204f1a85ea1ba3789e2da11673682931272933093">https://pdsapi.aliyundrive.com/v2/redirect?id=73e8b1fe5c204f1a85ea1ba3789e2da11673682931272933093</a></p>
<p><a href="https://pdsapi.aliyundrive.com/v2/redirect?id=73e8b1fe5c204f1a85ea1ba3789e2da11673682931272933093">73e8b1fe5c204f1a85ea1ba3789e2da11673682931272933093</a> g)</p>
<p>就是这个资源（flac 文件）在阿里云盘系统里面的编号</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(50).png" alt="Untitled"></p>
<p>这个一长串的才是真正的资源存放地址，播放器就是通过这个最终的url，打开资源播放，这个资源是有有效期的，就是这个标志，是个unix的时间戳，你转换一下就知道是6个小时</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(51).png" alt="Untitled"></p>
<p>也就是六小时后你再用同样的url是打不开这个连接的，因为失效了，为什么要搞那么复杂，阿里直接给个资源存放地址不就完了，这是因为为了给用户最好的体验，更快的打开，使用了前置的缓存，也就是CDN，不同的用户获取到的CDN资源地址是有可能不一样的，阿里的CDN遍布全国，北京有，广东也有，北京的用户去广东取就会慢，才去就近最快速度的原则，北京附近的就指向北京的CDN资源，广东附近的就指向广东的CDN资源，但是CDN是中间层做缓存用的，就好像你硬盘的一级缓存，不是资源的最终存放地，量有限而且贵（使用内存加高速硬盘肯定贵），所以需要把不用的资源删除腾出地方给有用的，所以就有了有效期这个限制，过了有效期就删除腾地。</p>
<p>另外，要说明的是alist的代理角色，它是流量代理，不是<del>缓存代理</del>，所以并不能提高真实的视频播放流畅度，我以水管作为例子，</p>
<p><strong>流量代理：</strong></p>
<p>在网络通畅的情况下A → C 直管连接是最快的，B就好比水管的弯头/三通，A和C之间有一堵墙没法直连，那只能A → B, 然后 B → C , 这样通了多少是有损毁的，流速（用网络的名词就是多了延迟），实际体验就是不能看的变成能看了</p>
<p><strong>缓存代理：</strong></p>
<p>在A 和 C通和不通的情况下都可以实现，这是B的角色更像是增压阀，A → B 的管子应该比 B→ C 的管子粗，通过增压阀来保证B→ C 的（水压）流速，缓存代理是包含了上面流量代理的功能，实际体验就是不但能看而且看起来不卡了</p>
<h1 id="如何定时和网站同步数据">如何定时和网站同步数据</h1>
<p>如果你是基于Linux系统的（包括openwrt），可以用以下方法设置定时更新，终端执行</p>
<p>crontab -e</p>
<p>添加一条记录</p>
<p>0 6 * * * docker restart xiaoya</p>
<ol>
<li>按 o 插入一行</li>
<li>然后把这堆文字输入进去</li>
<li>然后按键盘左上角 ESC键退出编辑模式</li>
<li>输入 :wq 保存退出</li>
</ol>
<p>就是每天凌晨6点自动重启xiaoya docker去同步数据，你把6改成13，那就是下午1点，至于编辑器vi的使用方法请自行百度。</p>
<h1 id="我的一些邀请码和推荐和小插件">我的一些邀请码和推荐和小插件</h1>
<h3 id="阿里注册">阿里注册</h3>
<p><a href="https://www.aliyundrive.com/s/RAofD2V2hHa">https://www.aliyundrive.com/s/RAofD2V2hHa</a></p>
<p>通过我的分享链接注册有500G，可以注册小号来配合docker用</p>
<h3 id="pikpak注册">pikpak注册</h3>
<p><a href="https://toapp.mypikpak.com/activity/invited?code=77602333">https://toapp.mypikpak.com/activity/invited?code=77602333</a>
<a href="https://toapp.mypikpak.com/activity/invited?code=39321258">https://toapp.mypikpak.com/activity/invited?code=39321258</a>
<a href="https://toapp.mypikpak.com/activity/invited?code=39321258">https://toapp.mypikpak.com/activity/invited?code=39321258</a>
<a href="https://toapp.mypikpak.com/activity/invited?code=83642225">https://toapp.mypikpak.com/activity/invited?code=83642225</a></p>
<h3 id="机场推荐">机场推荐</h3>
<p>虎云</p>
<p><a href="http://reserved.huyun.icu:50000/#/register?code=BMI25zNV">http://reserved.huyun.icu:50000/#/register?code=BMI25zNV</a></p>
<p>优惠码： <strong>pluto95</strong></p>
<p>TAG</p>
<p><a href="https://tagss01.pro#/register?invite=jmhQGmCg">https://tagss01.pro#/register?invite=jmhQGmCg</a></p>
<h3 id="检查token的有效性-32位">检查token的有效性 （32位）</h3>
<p>docker exec xiaoya /checktoken   xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
<p>xxxxxxxxxxxxxxxxxxxxxxxxxx   是你的 token</p>
<h3 id="检查open-token的有效性-280位">检查open token的有效性 （280位）</h3>
<p>docker exec xiaoya /checkopentoken   xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
<p>xxxxxxxxxxxxxxxxxxxxxxxxxx   是你的 open token</p>
<h3 id="手动签到阿里云盘">手动签到阿里云盘</h3>
<p>docker exec xiaoya /ali_auto_checkin.sh   xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
<p>xxxxxxxxxxxxxxxxxxxxxxxxxx   是你的 token</p>
<h3 id="油猴豆瓣插件包含小雅搜索">油猴豆瓣插件（包含小雅搜索）</h3>
<p><a href="https://greasyfork.org/zh-CN/scripts/461306-">https://greasyfork.org/zh-CN/scripts/461306-</a>豆瓣资源下载大师-包含小雅-豆瓣电影-音乐-图书下载</p>
<p><img src="/post-images/xiaoya_alist_docker/Untitled(52).png" alt="Untitled"></p>
<h3 id="如果你觉得小雅帮助了你请给小雅打赏不要吝啬哦">如果你觉得小雅帮助了你，请给小雅打赏，不要吝啬哦</h3>
<p><img src="/post-images/xiaoya_alist_docker/dashan.png" alt="dashan.png"></p>
        </div>
    </article>
    
    
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: ["margrop"],
      
      id: '\/post\/deploy-xiaoya-docker-and-tvbox\/',
      
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script>LA.init({id: "1vVTUWl7zoRjnKXi",ck: "1vVTUWl7zoRjnKXi"})</script>
    <script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script>
    <script>
      new LingQue.Monitor().init({id:"202teQt8THXwqyve"});
    </script>
</body>
</html>
