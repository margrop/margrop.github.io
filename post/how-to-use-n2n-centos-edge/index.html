<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>如何使用CentOS 7运行N2N—edge篇 - 魔都水滴</title>
<meta name="description" content="边缘节点（node）：将成为虚拟网络一部分的节点。">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://blog.margrop.net/post/how-to-use-n2n-centos-edge/">

<meta property="og:site_name" content="魔都水滴">
<meta property="og:title" content="如何使用CentOS 7运行N2N—edge篇 - 魔都水滴">
<meta property="og:description" content="边缘节点（node）：将成为虚拟网络一部分的节点。">
<meta property="og:url" content="https://blog.margrop.net/post/how-to-use-n2n-centos-edge/">
<meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.margrop.net/images/avatar.png"><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="如何使用CentOS 7运行N2N—edge篇 - 魔都水滴">
<meta name="twitter:description" content="边缘节点（node）：将成为虚拟网络一部分的节点。"><meta name="twitter:image" content="https://blog.margrop.net/images/avatar.png"><meta property="article:published_time" content="2021-01-16T14:00:18&#43;08:00">
<meta property="article:modified_time" content="2021-01-16T14:00:18&#43;08:00"><meta property="article:tag" content="n2n"><meta property="article:tag" content="network"><meta property="article:tag" content="centos"><meta property="article:tag" content="edge"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"魔都水滴"},"dateModified":"2021-01-16T14:00:18+08:00","datePublished":"2021-01-16T14:00:18+08:00","description":"边缘节点（node）：将成为虚拟网络一部分的节点。","headline":"如何使用CentOS 7运行N2N—edge篇","mainEntityOfPage":"https://blog.margrop.net/post/how-to-use-n2n-centos-edge/","url":"https://blog.margrop.net/post/how-to-use-n2n-centos-edge/"}</script>
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; }
        nav a { margin-right: 15px; text-decoration: none; color: #333; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
        <a href="/">首页</a>
        <a href="/post/">归档</a>
        <a href="/tag/">标签</a>
    </nav>
    <article>
        <h1>如何使用CentOS 7运行N2N—edge篇</h1>
        <div class="meta">
            发布时间: 2021-01-16
            
            | 标签: 
            
                
                <a href="/tag/n2n"><span class="tag">n2n</span></a>
            
                
                <a href="/tag/network"><span class="tag">network</span></a>
            
                
                <a href="/tag/centos"><span class="tag">centos</span></a>
            
                
                <a href="/tag/edge"><span class="tag">edge</span></a>
            
            
        </div>
        <div class="content">
            <p><code>边缘节点（node）</code>：将成为虚拟网络一部分的节点。</p>
<h1 id="已编译好的文件">已编译好的文件</h1>
<blockquote>
<p>编译环境：
CentOS Linux release 7.9.2009 (Core)
Linux version 3.10.0-1160.11.1.el7.x86_64 (<a href="mailto:mockbuild@kbuilder.bsys.centos.org">mockbuild@kbuilder.bsys.centos.org</a>) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) ) #1 SMP Fri Dec 18 16:34:56 UTC 2020</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install openssl
</span></span><span style="display:flex;"><span>wget https://download.margrop.net/d/oneindex/network/n2n_2.8_stable/CentOS7/edge -O edge
</span></span></code></pre></div><h1 id="手工启动edge">手工启动edge</h1>
<ul>
<li>给予可执行权限</li>
</ul>
<blockquote>
<p>若直接下载的可执行文件，请自行copy到下面的路径</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chmod +x /usr/local/sbin/edge
</span></span></code></pre></div><ul>
<li>测试是否能正常启动</li>
</ul>
<blockquote>
<p>提示：下面的 <code>-a</code> <code>-c</code> <code>-k</code> <code>-l</code>参数，请根据需求，自行修改</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>edge -d h0 -a 10.0.0.1 -c margrop -k UFDMIlrK3ueQz5mS -l blog.margrop.net:2345 -r -v -f
</span></span></code></pre></div><ul>
<li>edge参数简单解释，详情解释直接在命令行输入edge</li>
</ul>
<table>
<thead>
<tr>
<th>参数名</th>
<th>英文</th>
<th>中文</th>
<th>样例</th>
</tr>
</thead>
<tbody>
<tr>
<td>-d</td>
<td>tun device</td>
<td>虚拟网卡名称</td>
<td>-d h0</td>
</tr>
<tr>
<td>-a</td>
<td>Set interface address. For DHCP use &lsquo;-r -a dhcp:0.0.0.0&rsquo;</td>
<td>虚拟IP</td>
<td>-a 10.0.0.1</td>
</tr>
<tr>
<td>-c</td>
<td>n2n community name the edge belongs to.</td>
<td>Community名称（即虚拟网用户名）</td>
<td>-c margrop</td>
</tr>
<tr>
<td>-k</td>
<td>Encryption key (ASCII) - also N2N_KEY=<!-- raw HTML omitted -->.</td>
<td>Community密码（即虚拟网密码）</td>
<td>-k UFDMIlrK3ueQz5mS</td>
</tr>
<tr>
<td>-l</td>
<td>Supernode IP:port</td>
<td>Supernode地址，域名:端口或IP:端口</td>
<td>-l blog.margrop.net:2345</td>
</tr>
<tr>
<td>-r</td>
<td>Enable packet forwarding through n2n community.</td>
<td>启用通过n2n Community转发数据包。</td>
<td>-r</td>
</tr>
<tr>
<td>-v</td>
<td>Make more verbose. Repeat as required.</td>
<td>启动verbose模式，打印更多的日志</td>
<td>-v</td>
</tr>
<tr>
<td>-f</td>
<td>do not fork and run as a daemon; rather run in foreground.</td>
<td>不要Fork并作为守护进程运行，而是在前台运行</td>
<td>-n</td>
</tr>
</tbody>
</table>
<h1 id="自动启动edge">自动启动edge</h1>
<ul>
<li>编辑systemctl的启动文件</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim /etc/systemd/system/edge.service
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>N2N Edge Run On Port <span style="color:#ae81ff">2012</span> UDP
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>supernode.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/local/sbin/edge -a 10.0.0.1 -c margrop -k UFDMIlrK3ueQz5mS -l blog.margrop.net:2345 -r -v -f
</span></span><span style="display:flex;"><span>TimeoutStartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>supernode.target
</span></span></code></pre></div><ul>
<li>启动服务</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl stop edge
</span></span><span style="display:flex;"><span>systemctl start edge
</span></span><span style="display:flex;"><span>systemctl status edge
</span></span></code></pre></div><ul>
<li>设置为自动启动</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl enable edge
</span></span></code></pre></div><h1 id="下面为可选设置若看不懂忽略即可">下面为可选设置，若看不懂，忽略即可</h1>
<ul>
<li>启用CentOS的ip_forward</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim /etc/sysctl.conf
</span></span></code></pre></div><p>加入此行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>net.ipv4.ip_forward <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>加载sysctl</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sysctl -p
</span></span></code></pre></div><ul>
<li>配置CentOS的路由表<code>（重要：不能加入自己本地的网段路由）</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>route del -net 192.168.1.0 netmask 255.255.255.0 gw 10.0.0.1
</span></span><span style="display:flex;"><span>route add -net 192.168.1.0 netmask 255.255.255.0 gw 10.0.0.1
</span></span><span style="display:flex;"><span>route del -net 192.168.103.0 netmask 255.255.255.0 gw 10.0.0.103
</span></span><span style="display:flex;"><span>route add -net 192.168.103.0 netmask 255.255.255.0 gw 10.0.0.103
</span></span><span style="display:flex;"><span>route del -net 192.168.113.0 netmask 255.255.255.0 gw 10.0.0.113
</span></span><span style="display:flex;"><span>route add -net 192.168.113.0 netmask 255.255.255.0 gw 10.0.0.113 
</span></span></code></pre></div><ul>
<li>打开Firewalld防火墙，启用NAT功能</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>firewall-cmd --set-default-zone<span style="color:#f92672">=</span>public
</span></span><span style="display:flex;"><span>firewall-cmd --permanent --zone<span style="color:#f92672">=</span>public --change-interface<span style="color:#f92672">=</span>sh0
</span></span><span style="display:flex;"><span>firewall-cmd --permanent --zone<span style="color:#f92672">=</span>public --add-masquerade
</span></span><span style="display:flex;"><span>firewall-cmd --zone<span style="color:#f92672">=</span>public --list-all
</span></span><span style="display:flex;"><span>firewall-cmd --reload
</span></span><span style="display:flex;"><span>firewall-cmd --list-all
</span></span><span style="display:flex;"><span>firewall-cmd --get-active-zones
</span></span></code></pre></div><h1 id="参考文献">参考文献</h1>
<p>1.<a href="https://www.jianshu.com/p/5021b70c3ff9">n2n实现内网穿透</a></p>
        </div>
    </article>
    
    
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: "[\"margrop\"]",
      id: '8d4b512d6ab14ac626072c34196a9d8d96aa41d2',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
</body>
</html>
