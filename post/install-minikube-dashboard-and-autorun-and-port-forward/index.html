<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>安装 minikube-dashboard &#43; 自动启动和外网访问 - 魔都水滴</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="baidu-site-verification" content="code-sVFZ8SER59" />
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J2W592DHJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3J2W592DHJ');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
        .content { line-height: 1.8; }
        .content code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
        .content pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
        .content img { max-width: 100%; height: auto; }
        .tags { margin-top: 30px; }
        .tag { background: #eee; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        nav { margin-bottom: 30px; }
        nav a { margin-right: 15px; text-decoration: none; color: #333; }
        nav a:hover { color: #006CFF; }
        a { color: #006CFF; }
    </style>
</head>
<body>
    <nav>
        <a href="/">首页</a>
        <a href="/post/">归档</a>
        <a href="/tag/">标签</a>
    </nav>
    <article>
        <h1>安装 minikube-dashboard &#43; 自动启动和外网访问</h1>
        <div class="meta">
            发布时间: 2024-04-30
            
            | 标签: 
            
                
                <a href="/tag/k8s"><span class="tag">k8s</span></a>
            
            
        </div>
        <div class="content">
            <h1 id="一安装-minikube-dashboard">一、安装 minikube-dashboard</h1>
<blockquote>
<p>参考官网文档：<a href="https://minikube.sigs.k8s.io/docs/start/">https://minikube.sigs.k8s.io/docs/start/</a>
执行命令 <code>minikube dashboard</code></p>
</blockquote>
<h1 id="二安装-minikube-后台服务">二、安装 minikube 后台服务</h1>
<p>如果你希望 <code>minikube</code> 在 <code>systemctl</code> 管理下只启动一次，并且在启动成功后自动退出，你可以调整 <code>systemctl</code> 的服务文件，使其不会自动重启 <code>minikube</code>。这可以通过设置 <code>Restart=no</code> 来实现，并确保服务只在需要时手动启动。</p>
<p>下面是一个基本的 <code>systemctl</code> 服务文件示例，适用于这种情况：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#75715e">#minikube自启动脚本</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#/etc/systemd/system/minikube.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Description</span><span style="color:#f92672">=</span><span style="color:#e6db74">Minikube Kubernetes</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">After</span><span style="color:#f92672">=</span><span style="color:#e6db74">docker.service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Requires</span><span style="color:#f92672">=</span><span style="color:#e6db74">docker.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Service]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Type</span><span style="color:#f92672">=</span><span style="color:#e6db74">oneshot</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">User</span><span style="color:#f92672">=</span><span style="color:#e6db74">root</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RemainAfterExit</span><span style="color:#f92672">=</span><span style="color:#e6db74">yes</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Environment</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;HOME=/root&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Environment</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MINIKUBE_HOME=/root/.minikube&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ExecStart</span><span style="color:#f92672">=</span><span style="color:#e6db74">/usr/local/bin/minikube start --force</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WantedBy</span><span style="color:#f92672">=</span><span style="color:#e6db74">multi-user.target</span>
</span></span></code></pre></div><h3 id="解释">解释</h3>
<ul>
<li>
<p><strong>Type=oneshot</strong>：这表明服务是一次性的，即执行一次后就认为已经完成。这对于执行脚本或命令非常有用，这些脚本或命令在执行完后不需要保持运行状态。</p>
</li>
<li>
<p><strong>RemainAfterExit=yes</strong>：即使服务的主进程已退出，也认为此服务仍然是活跃的。这对于 <code>minikube</code> 启动完毕后适用，因为它不需要持续运行一个后台进程。</p>
</li>
<li>
<p><strong>Restart=no</strong>：这表示如果服务退出，不论成功还是失败，<code>systemd</code> 都不会尝试重启服务。</p>
</li>
</ul>
<h3 id="使用步骤">使用步骤</h3>
<ol>
<li>
<p><strong>创建服务文件</strong>：将上述内容保存到 <code>/etc/systemd/system/minikube.service</code>。</p>
</li>
<li>
<p><strong>重载 <code>systemd</code> 配置</strong>：更新 <code>systemd</code> 以识别你的新服务或服务文件的更改。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span></code></pre></div></li>
<li>
<p><strong>启动服务</strong>：使用 <code>systemctl</code> 启动 <code>minikube</code> 服务。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl start minikube.service
</span></span></code></pre></div></li>
<li>
<p><strong>检查状态</strong>：验证服务的状态，确保没有错误。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl status minikube.service
</span></span></code></pre></div></li>
<li>
<p><strong>启用服务</strong>：如果希望在系统启动时自动运行 Minikube（只执行一次，然后退出），可以启用服务。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl enable minikube.service
</span></span></code></pre></div></li>
</ol>
<p>这样配置后，Minikube 将在系统启动时运行一次并初始化完成后退出，但不会再自动重启。</p>
<h1 id="三安装-minikube-dashboard-后台服务">三、安装 minikube-dashboard 后台服务</h1>
<ul>
<li>步骤同上，这里不再重复，将简化操作说明</li>
<li>编辑文件 <code>/etc/systemd/system/minikube-dashboard.service</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#75715e">#Minikube自启动并自动映射 dashboard 端口</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#/etc/systemd/system/minikube-dashboard.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Description</span><span style="color:#f92672">=</span><span style="color:#e6db74">Auto-start Kubernetes Dashboard with port-forwarding</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">After</span><span style="color:#f92672">=</span><span style="color:#e6db74">minikube.service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Requires</span><span style="color:#f92672">=</span><span style="color:#e6db74">minikube.service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Wants</span><span style="color:#f92672">=</span><span style="color:#e6db74">network-online.target</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">After</span><span style="color:#f92672">=</span><span style="color:#e6db74">network-online.target</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Service]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Type</span><span style="color:#f92672">=</span><span style="color:#e6db74">simple</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">User</span><span style="color:#f92672">=</span><span style="color:#e6db74">root</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Environment</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;HOME=/root&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Environment</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MINIKUBE_HOME=/root/.minikube&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ExecStartPre</span><span style="color:#f92672">=</span><span style="color:#e6db74">kubectl wait --for=condition=ready pod --selector=k8s-app=kubernetes-dashboard -n kubernetes-dashboard --timeout=120s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ExecStart</span><span style="color:#f92672">=</span><span style="color:#e6db74">/bin/bash -c &#39;kubectl port-forward --address 0.0.0.0 service/kubernetes-dashboard 8080:80 -n kubernetes-dashboard&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RemainAfterExit</span><span style="color:#f92672">=</span><span style="color:#e6db74">no</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WantedBy</span><span style="color:#f92672">=</span><span style="color:#e6db74">multi-user.target</span>
</span></span></code></pre></div><ul>
<li>常规服务操作</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#重载服务配置</span>
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span><span style="color:#75715e">#配置自启动</span>
</span></span><span style="display:flex;"><span>sudo systemctl enable minikube-dashboard.service
</span></span><span style="display:flex;"><span><span style="color:#75715e">#手工启动服务</span>
</span></span><span style="display:flex;"><span>sudo systemctl start minikube-dashboard.service
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看服务状态</span>
</span></span><span style="display:flex;"><span>sudo systemctl status minikube-dashboard.service
</span></span></code></pre></div>
        </div>
    
    
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<div id="gitalk-container" style="margin-top:40px"></div>
<script>
  (function(){
    var gitalk = new Gitalk({
      clientID: '3181fd94e501cc5db0ad',
      clientSecret: 'af1dab79dae02c69296e6615bfcecf47fc8615ee',
      repo: 'margropcomment.margrop.io',
      owner: 'margrop',
      admin: "[\"margrop\"]",
      id: 'ce03eba77c7b7c17d452a22fa3dbf1f5c74258f5',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  })();
</script>
  



    <script type="text/javascript" src="https://js.users.51.la/21044367.js"></script>
</body>
</html>
